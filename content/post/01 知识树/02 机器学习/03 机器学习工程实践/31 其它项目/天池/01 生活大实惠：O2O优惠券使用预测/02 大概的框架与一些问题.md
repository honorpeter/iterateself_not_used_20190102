---
title: 02 大概的框架与一些问题
toc: true
date: 2018-07-15 22:18:18
---
## 需要明确的一些点


一:测试集中有重复的USER_ID, COUPON_ID, DATE_RECEIVED，怎么测评
答：三者都重复只计算一个，提交分数 取max 那个，真实 label 则取（1如果有至少一个被使用了）

二:为什么提交的结果AUC=0.5的原因说明
答：
1.没有严格按照 user_id,coupon_id,date_received,probability 这样4列提交。特别地，第二列是 coupon_id 不是 merchant_id，第二列是 coupon_id 不是 merchant_id，第二列是 coupon_id 不是 merchant_id；
2.分隔符使用了中文'，'而不是英文','；
3.提交的user_id,coupon_id,date_received与测试集不同（比如直接提交sample_submission.csv）
4.预测结果的所有概率值相等

三：关于数据与评价方式

赛题提供用户在2016年1月1日至2016年6月30日之间真实线上线下消费行为，预测用户在2016年7月领取优惠券后15天以内的使用情况。 使用优惠券核销预测的平均AUC（ROC曲线下面积）作为评价标准。 即对每个优惠券 coupon_id 单独计算核销预测的 AUC 值，再对所有优惠券的 AUC 值求平均作为最终的评价标准。<span style="color:red;">怎么求单独的AUC和平均的AUC？</span>

当测试集中的正负样本的分布变化的时候，ROC曲线能够保持不变。因为在实际的数据集中经常会出现类不平衡，所以次点也是AUC指标的优势。<span style="color:red;">什么是次点？</span>



## 问题解决流程

### 先简单的查看和分析数据

必须要对数据有所了解，对数据心里有数，要用到一些基本的数据分析方法。


### 提出一些解决办法

提供数据的区间是 2016-01-01~2016-06-30，预测七月份用户领券使用情况，即用或者不用，转化为**二分类问题**，然后通过分类算法预测结果。



### 数据集划分

最初没有使用数据划分，导致特征中产生数据泄露，以至于在训练数据上效果很好，线下测试也还不错，在线上表现确差强人意，后来划分了之后有明显提升。<span style="color:red;">什么叫特征中产生数据泄露？</span>

| 集合   | 预测区间                                      | 特征区间                                      |
| ------ | --------------------------------------------- | --------------------------------------------- |
| 预测集 | 领券:20160701~20160731                        | 领券 & 消费:20160101~20160630                   |
| 训练集 | 领券:20160515~20160615 消费:20160515~20160630 | 领券:20160101~20160501 消费:20160101~20160515 |

可以划分多个训练集。<span style="color:red;">什么叫预测区间和特征区间？要明确。</span>



可以采用滑窗的方法得到多份训练数据集，特征区间越小，得到的训练数据集越多。以下是一种划分方式：

![mark](http://pacdb2bfr.bkt.clouddn.com/blog/image/180715/7hK1BD0l1G.png?imageslim)

划取多份训练集，一方面可以增加训练样本，另一方面可以做交叉验证实验，方便调参。

<span style="color:red;">什么是滑窗的方法划分？大概知道，不过还是要添加到数据集划分的方法里面。</span>


### 数据集划分与特征工程

根据这两份数据表，我们首先对数据集进行划分，然后提取了

- 用户相关的特征、
- 商家相关的特征，
- 优惠劵相关的特征，
- 用户与商家之间的交互特征，
- 用户优惠券组合特征。
- 以及利用本赛题的 leakage 得到的其它特征（这部分特征在实际业务中是不可能获取到的）。即在测试区间提取了当天的前后7/3/1天的领券信息（这里面后七天的特征其实是不能应用于工业应用的，因为实际预测中你无法知道后7/3/1天的领券信息），提升较大。

### 准备使用的模型方法

<span style="color:red;">是不是一般经常使用模型融合方法？好像 kaggle 经常使用模型融合方法。</span>

最后使用 GBDT、RandomForest、LR 进行基于 rank 的分类模型融合。<span style="color:red;">什么叫基于rank 的分类模型融合？</span>


最后训练了XGBoost，GBDT，RandomForest进行模型融合。

<span style="color:red;">到底怎么实现这些模型的？又是怎么融合在一起的？为什么要这几种模型？别的不行吗？</span>
