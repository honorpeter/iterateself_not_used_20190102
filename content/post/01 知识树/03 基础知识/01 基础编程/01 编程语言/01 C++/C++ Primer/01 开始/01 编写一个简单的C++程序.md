---
title: 01 编写一个简单的C++程序
toc: true
date: 2018-07-10 17:40:59
---
# 开始


本章将介绍 C++ 的大部分基础内容：

- 类型
- 变量
- 表达式
- 语句
- 函数

在这个过程中， 我们会简要介绍如何编译及运行程序。<span style="color:red;">嗯。</span>

在学习完本章并认真完成练习之后，你将具备编写、编译及运行简单程序的能力。后续章节将假定你已掌握本章中介绍的语言特性，并将更详细地解释这些特性。

学习一门新的程序设计语言的最好方法就是练习编写程序。在本章中，我们将编写一个程序来解决简单的书店问题。

我们的书店保存所有销售记录的档案，每条记录保存了某本书的一次销售的信息(一册或多册)，每条记录包含三个数据项：

```
0-201-70353-X    4    24.99
```

- 第一项是书的ISBN号(国际标准书号，一本书的唯一标识)，
- 第二项是售出的册数，
- 最后一项是书的单价。

有时，书店老板需要查询此档案，计算每本书的销售量、销售额及平均售价，

为了编写这个程序，我们需要使用若干 C++ 的基本特性。而且，我们需要了解如何编译及运行程序。

虽然我们还没有编写这个程序，但显然它必须

- 定义变量
- 进行输入和输出
- 使用数据结构保存数据
- 检测两条记录是否有相同的ISBN
- 包含一个循环来处理销售档案中的每条记录

我们首先介绍如何用 C++ 来解决这些子问题，然后编写书店程序。

## 1 编写一个简单的 C++ 程序

每个C++程序都包含一个或多个函数(fiinction)，其中一个必须命名为main。操作系统通过调用 main 来运行 C++ 程序。下面是一个非常简单的 main 函数，它什么也不干，只是返回给操作系统一个值：<span style="color:red;">系统是怎么调用main函数的？而且返回值到底能表示哪些信息？程序崩溃也会返回吗？一定会返回吗？</span>

```cpp
int main()
{
    return 0;
}
```

一个函数的定义包含四部分：

- 返回类型 (return type)
- 函数名 (function name)
- 一个括号包围的形参列表 (parameter list,允许为空)
- 以及函数体 (function body)

虽然main 函数在某种程度上比较特殊，但其定义与其他函数是一样的，

在本例中，main的形参列表是空的(()中什么也没有)。章 06 会讨论main的其他形参类型。<span style="color:red;">嗯，一直想弄清楚 main 函数的argv argc 什么的。而且到底有哪些传入的方式？快捷方式是怎么传入参数的？</span>

main 函数的返回类型必须为 int，即整数类型。int类型是一种内置类型(built-in type)，即语言自身定义的类型。<span style="color:red;">还有哪些内置类型？</span>

函数定义的最后一部分是函数体，它是一个以左花括号(curly brace)开始，以右花括号结朿的语句块(block of statements)：

```cpp
{
  return 0;
}
```

这个语句块中唯一的一条语句是 return，它结束函数的执行。在本例中，return 还会向调用者返回一个值。当 return 语句包括一个值时，此返回值的类型必须与函数的返回类型相容。在本例中，main 的返回类型是int，而返回值 0 的确是一个 int 类型的值。<span style="color:red;">嗯。</span>

请注意，return 语句末尾的分号。在 C++ 中，大多数 C++ 语句以分号表示结束。它们很容易被忽略，但如果忘记了写分号，就会导致莫名其妙的编译错误。<span style="color:red;">嗯。</span>

在大多数系统中，main 的返回值被用来指示状态。返回值 0 表明成功，非 0 的返回值的含义由系统定义，通常用来指出错误类型。<span style="color:red;">有哪些错误类型？系统知道这些错误类型之后会做什么？我在返回错误类型之后还可以执行什么吗？</span>

上面提到了类型，类型是程序设计最基本的概念之一，在本书中我们会反复遇到它,，一种类型不仅定义了数据元素的内容，还定义了这类数据上可以进行的运算。程序所处理的数据都保存在变量中，而每个变量都有自己的类型。如果一个名为 v 的变量的类型为 T ，我们通常说 “V具有类型T”，或等价的，“V是一个T类型变量”。 <span style="color:red;">每个变量都有自己的类型。</span>

### 1.1 编译、运行程序

编写好程序后，我们就需要编译它。如何编译程序依赖于你使用的操作系统和编译器。

你所使用的特定编译器的相关使用细节，请查阅参考手册或询问经验丰富的同事。

很多 PC 机上的编译器都具备集成开发环境 (Integrated Developed Environment IDE).

将编译器与其他程序创建和分析工具包装在一起。在开发大型程序时，这类集成环境可能是非常有用的工具，但需要一些时间来学习如何高效地使用它们。学习如何使用这类开发 环境已经超出了本书的范围。

大部分编译器，包括集成 IDE 的编译器，都会提供一个命令行界面。除非你已经了解 IDE，否则你会觉得借助命令行界面开始学习 C++ 还是很容易的。这种学习方式的好处是，可以先将精力集中于 C++ 语言本身(而不是一些开发工具)，而且，一旦你掌握了语言，IDE 通常是很容易学习的。

### 程序源文件命名约定

无论你使用命令行界面或者 IDE ,大多数编译器都要求程序源码存储在一个或多个文件中。程序文件通常被称为源文件(source file)。在大多数系统中，源文件的名字以一个后缀为结尾，后缀是由一个句点后接一个或多个字符组成的。后缀告诉系统这个文件是一个 C++ 程序。不同编译器使用不同的后缀命名约定，最常见的包括 `.cc`、`.cxx`、`.cpp`、`.cp` 及 `.C`。<span style="color:red;">源文件本质上就是一个文本文件，只是后缀不是 txt 而已。应该是吧？</span>

### 从命令行运行编译器

如果我们正在使用命令行界面，那么通常是在一个控制台窗口内(例如UNIX系统中 的外壳程序窗口或者Windows系统中的命令提示符窗口)编译程序。假定我们的 main 程序保存在文件 progl.cc 中，可以用如下命令来编译它

```
$ CC progl.cc
```

其中，CC 是编译器程序的名字，$ 是系统提示符。编译器生成一个可执行文件。Windows 系统会将这个可执行文件命名为 `progl.exe` 。 UNIX系统中的编译器通常将可执行文件命名为 `a. out`。

为了在Windows系统中运行一个可执行文件，我们需要提供可执行文件的文件名，可以忽略其扩展名.exe:

```
$ progl
```

在一些系统中，即使文件就在当前目录或文件夹中，你也必须显式指出文件的位置。在此情况下，我们可以键入：<span style="color:blue;">是这样吗？什么系统会这样？怪不得我看到的都是带 ./ 很少直接写程序的名字的。不是斜杠吗？怎么是反斜杠？linux上是斜杠。</span>

```
$ .\progl
```

`.` 后跟一个反斜线指出该文件在当前目录中。

为了在UNIX系统中运行一个可执行文件，我们需要使用全文件名，包括文件扩展名：<span style="color:red;">这个如果不带 `./` 的话在centos里会不行，会说：`-bash: a.out: command not found` ,必须要使用 `./a.cout` 才行。</span>

```
$ a.out
```

如果需要指定文件位置，需要用一个后跟一个斜线来指出可执行文件位于当前目录中：

```
$ ./a.out
```

访问 main 的返回值的方法依赖于系统。在 UNIX 和 Windows 系统中，执行完一个程序后，都可以通过 echo 命令获得其返回值。

在UNIX系统中，通过如下命令获得状态：<span style="color:red;">这个我试了下的确是会输出0，但是为什么呢？echo到底是怎么用的？</span>

```
$ echo $?
```

在Windows系统中查看状态可键入：

```
$ echo %ERRORLEVEL%
```

> ### 运行GNU或微软编译器
>
> 在不同操作和编译器系统中，运行C++编译器的命令也各不相同。最常用的编译器是 GNU 编译器和微软 Visual Studio 编译器。默认情况下，运行 GNU 编译器的命令是 g++:
>
> ```
> $ g++ -o progl progl.cc
> ```
>
> 此处，`$`是系统提示符。`-o progl`是编译器参数，指定了可执行文件的文件名。在不同的操作系统中，此命令生成一个名为 `progl` 或 `progl.exe` 的可执行文件，在 UNIX 系统中，可执行文件没有后缀；在 Windows 系统中，后缀为.exet。如果省略了 `-o progl` 参数，在UNIX系统中编译器会生成一个名为 `a.out` 的可执行文件，在 Windows 系统 中则会生成一个名为 `a.exe` 的可执行文件（注意：根据使用的GNU编译器的版本，你 可能需要指定-std=c++0x参数来打开对C++11的支持）。<span style="color:red;">这个要怎么打开？</span>
>
> 运行微软Visual Studio 2010编译器的命令为 cl :<span style="color:red;">好像从来没有手动使用过这个</span>
>
> ```
> C:\Users\me\Programs> cl /EHsc progl.cpp
> ```
>
> 此处，`C:\Users\me\Programs>` 系统提示符，`\Users\me\Programs` 是当前目录名（即当前文件夹命令 `cl` 调用编译器，`/EHsc` 是编译器选项，用来打开标准异常处理。微软编译器会自动生成一个可执行文件，其名字与第一个源文件名对应<span style="color:red;"> 嗯，这个地方还是不一样的。</span>。可执行文件的文件名与源文件名相同，后缀为 `.exe` 。在此例中，可执行大件的文件名为 `progl.exe` 。
>
> 编译器通常都包含一些选项，能对有问题的程序结构发出警告。打开这些选项通常是一个好习惯。我们习惯在 GNU 编译器中使用 `-Wall` 选项，在微软编译器中则使用 `/W4` 。<span style="color:red;">嗯，还有哪些选项？这个在写 makefile 的时候都会用到，还是要好好总结下。</span>
>
> 更详细的信息请查阅你使用的编译器的参考手册。<span style="color:red;">嗯，肯定要总结下的，因为 VS 对应复杂结构的大型项目还是有点不方便的，自己会编译的话使用 make 还是有用的。</span>

### 练习

练习1.1:查阅你使用的编译器的文档，确定它所使用的文件命名约定。编译并运行上面的main程序。

练习1.2:改写程序，让它返回 -1。返回值-1通常被当作程序错误的标识。重新编译并 运行你的程序，观察你的系统如何处理main返回的错误标识。<span style="color:red;">为什么使用centos 的 g++ 编译出的返回 -1 的 a.out 运行的时候什么也没有提示？而且运行后再运行 echo $? 的结果是 255 ？</span>
