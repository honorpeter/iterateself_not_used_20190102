---
title: 02 初识输入输出
toc: true
date: 2018-08-03 17:52:17
---

## 2 初识输入输出

C++语言并未定义任何输入输出（IO）语句，取而代之，包含了一个全面的标准库 （standard library）来提供 IO 机制（以及很多其他设施）。对于很多用途，包括本书中的示例来说，我们只需了解 IO 库中一部分基本概念和操作。<span style="color:red;">什么意思？C++里面是没有自带IO语句的吗？嗯，好像是这样，使用的 cout printf 什么的都是 std 的。</span>

本书中的很多示例都使用了 iostream 库。iostream 库包含两个基础类型 istream 和 ostream，分别表示输入流和输出流。一个流就是一个字符序列，是从 IO 设备读出或写入 IO 设备的，术语“流” （stream）想要表达的是，随着时间的推移，字符是顺序生成或消耗的。<span style="color:red;">一直想知道这个流底层是怎么实现的？是一个序列吗？</span>

### 标准输入输出对象

标准库定义了 4 个 IO 对象。为了处理输入，我们使用一个名为 `cin` （发音为see-in）的 istream 类型的对象。这个对象也被称为标准输入（standard input）。对于输出，我们使用一个名为`cout` （发音为see-out）的 ostream 类型的对象。此对象也被称为标准输出（standard output）。标准库还定义了其他两个 ostream 对象，名为`cerr`和`clog` （发音分别为see-err和see-log）。我们通常用`cerr`来输出警告和错误消息，因此它也被称为标准错误（standard error）.，而`clog`用来输出程序运行时的一般性信息。<span style="color:red;">一直想知道这个cerr和clog到底使用在什么时候？我好像基本没有使用过这两个。</span>

系统通常将程序所运行的窗口与这些对象关联起来。因此，当我们读取`cin`,数据将从程序正在运行的窗口读入，当我们向`cout`、`cerr`和`clog`写入数据时，将会写到同一个窗口。<span style="color:red;">cerr 和 clog 也会写到当前的窗口吗？</span>

### 一个使用 IO 库的程序

在书店程序中，我们需要将多条记录合并成单一的汇总记录。作为一个相关的，但更简单的问题，我们先来看一下如何将两个数相加。通过使用 IO 库，我们可以扩展 main 程序，使之能提示用户输入两个数，然后输出它们的和：

```cpp
#include <iostream>

int main()
{
    std::cout <<"Enter two numbers:" << std::endl;
    int v1 = 0, v2 = 0;
    std::cin >> v1 >> v2;
    std::cout << "The sum of "<< v1 << " and " << v2 << " is "<< v1+v2 << std::endl;
    return 0;
}
```

这个程序开始时在用户屏幕打印

```
Enter two numbers:
```

然后等待用户输入。如果用户键入

```
3 7
```

然后键入一个回车，则程序产生如下输出:

```
The sum of 3 and 7 is 10
```

程序的第一行

```cpp
#include <iostream>
```

告诉编译器我们想要使用`iostream`库。尖括号中的名字（本例中是iostream）指出了一个头文件（header）。每个使用标准库设施的程序都必须包含相关的头文件。`#include`指令和头文件的名字必须写在同一行中。通常情况下，`#include`指令必须出现在所有函数之外。<span style="color:red;">嗯，通常情况下，那么特殊情况有哪些？</span>我们一般将一个程序的所有`#include`指令都放在源文件的开始位置。

### 向流写入数据

main的函数体的第一条语句执行了一个表达式（expression）。在C++中，一个表达式产生一个计算结果，它由一个或多个运算对象和（通常是）一个运算符组成。这条语句中的表达式使用了输出运算符（<<）在标准输出上打印消息：

```
std::cout <<"Enter two numbers:" << std::endl;
```

`<<`运算符接受两个运算对象：左侧的运算对象必须是一个 ostream 对象，右侧的运算对象是要打印的值。此运算符将给定的值写到给定的 ostream 对象中。输出运算符的计算结果就是其左侧运算对象。即，计算结果就是我们写入给定值的那个 ostream 对象。

我们的输出语句使用了两次`<<`运算符。因为此运算符返回其左侧的运算对象，因此第一个运算符的结果成为了第二个运算符的左侧运算对象。<span style="color:red;">嗯，这样连着用的原因，以前我不是很明确这个。</span>这样，我们就可以将输出请求连接起来。因此，我们的表达式等价于

```
(std::cout <<"Enter two numbers:" )<< std::endl;
```

链中每个运算符的左侧运算对象都是相同的，在本例中是 `std::cout` 。我们也可以用两条语句生成相同的输出：

```
std::cout <<"Enter two numbers:";
std::cout << std::endl;
```

第一个输出运算符给用户打印一条消息。这个消息是一个字符串字面值常量（string literal），是用一对双引号包围的字符序列。在双引号之间的文本被打印到标准输出。

第二个运算符打印`endl`,这是一个被称为操纵符（manipulator）的特殊值。写入 `endl` 的效果是结束当前行，并将与设备关联的缓冲区（buffer）中的内容刷到设备中。缓冲刷新操作可以保证到目前为止程序所产生的所有输出都真正写入输出流中，而不是仅停留在内存中等待写入流。<span style="color:red;">这个地方总是感觉特别厉害和神秘，到底这个过程是怎样的呢？是怎么实现的呢？</span>

**注意：程序员常常在调试时添加打印语句。这类语句应该保证 “一直” 刷新流。否则，如果程序崩溃，输出可能还留在缓冲区中，从而导致关于程序崩溃位置的错误推断。**<span style="color:red;">嗯，是这样。</span>

### 使用标准库中的名字

细心的读者可能会注意到这个程序使用了 `std::cout` 和 `std::endl`,而不是直接 的`cout`和`endl`。前缀`std::`指出名字`cout`和`endl`是定义在名为`std`的命名空间 (namespace)中的。命名空间可以帮助我们避免不经意的名字定义冲突，以及使用库中相同名字导致的冲突。标准库定义的所有名字都在命名空间`std`中。

通过命名空间使用标准库有一个副作用：当使用标准库中的一个名字时，必须显式说明我们想使用来自命名空间std中的名字。例如，需要写出`std::cout`,通过使用作用域运算符(::)来指出我们想使用定义在命名空间`std`中的名字`cout`。 章 03 将给出一个更简单的访问标准库中名字的方法。<span style="color:red;">嗯。</span>

### 从流读取数据

在提示用户输入数据之后，接下来我们希望读入用户的输入。首先定义两个名为 v1 和 v2 的变量(variable)来保存输入：

```cpp
int v1 = 0, v2 = 0;
```

我们将这两个变量定义为`int`类型，`int`是一种内置类型，用来表示整数。还将它们初始化(initialize)为0。初始化一个变量，就是在变量创建的同吋为它赋予一个值。

下一条语句是

```cpp
std::cin >> vl >> v2;
```

它读入输入数据。输入运算符(>>)与输出运算符类似，它接受一个 istream 作为其左侧运算对象，接受一个对象作为其右侧运算对象。它从给定的 istream 读入数据，并存入给定对象中。与输出运算符类似，输入运算符返回其左侧运算对象作为其计算结果。因此，此表达式等价于

```cpp
(std::cin >> v1) >> v2;
```

由于此运算符返回其左侧运算对象，因此我们可以将一系列输入请求合并到单一语句中。

本例中的输入操作从 `std::cin` 读入两个值，并将第一个值存入vl,将第二个值存入V2。

换句话说，它与下面两条语句的执行结果是一样的：<span style="color:red;">嗯，是的，这个解决了我很久以前的疑惑，我一直想知道，为什么程序知道我是输入的两个数字？现在才知道，他每接收到一个数字，会返回左侧的运算对象，然后接受下一个数字。嗯。</span>

```cpp
std::cin >> vl; std::cin >> v2;
```

### 完成程序

剩下的就是打印计算结果了：

```cpp
std::cout << "The sum of "<< v1 << " and " << v2 << " is "<< v1+v2 << std::endl;
```

这条语句虽然比提示用户输入的打印语句更长，但原理上是一样的，它将每个运算对象打印在标准输出上。本例一个有意思的地方在于，运算对象并不都是相同类型的值。某些运算对象是字符串字面值常量，例如 "The sum of" 。其他运算对象则是int值，如 v1、 v2 以及算术表达式 v1+v2 的计算结果。标准库定义了不同版本的输入输出运算符，來处理这些不同类型的运算对象。<span style="color:red;">嗯，这就是为什么可以统一使用 `<<` 来处理不同的类型的运算对象的原因。</span>




### 练习

练习1.3:编写程序，在标准输出上打印 Hello, World。

练习1.4:我们的程序使用加法运算符`+`来将两个数相加。编写程序使用乘法运算符`*`, 来打印两个数的积。

练习1.5:我们将所有输出操作放在一条很长的语句中。重写程序，将每个运算对象的打印操作放在一条独立的语句中。

练习1.6:解释下面程序片段是否合法。

```cpp
std: :cout << "The sum of " << vl;
            << " and " << v2;
            << " is " << vl + v2 << std::endl;
```

如果程序是合法的，它输出什么？如果程序不合法，原因何在？应该如何修正？不合法，前面两行末尾使用 `;` 隔开了整行。
