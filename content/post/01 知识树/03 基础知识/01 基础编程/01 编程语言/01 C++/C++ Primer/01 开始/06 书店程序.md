---
title: 06 书店程序
toc: true
date: 2018-08-03 18:48:50
---

## 1.6书店程序

现在我们已经准备好完成书店程序了。我们需要从一个文件中读取销售记录，生成每本书的销售报告，显示售出册数、总销售额和平均售价。我们假定每个 ISBN 书号的所有销售记录在文件中是聚在一起保存的。

我们的程序会将每个 ISBN 的所有数据合并起来，存入名为 `total` 的变量中。我们使用另一个名为 `trans` 的变量保存读取的毎条销售记录。如果 `trans` 和 `total` 指向相同的 ISBN ，我们会更新 `total` 的值。否则，我们会打印 `total` 的值，并将其重置为刚刚读取的数据(`trans`):


```cpp
#include <iostream>
#include "Sales_item.h"

int main(){
    Sales_item total;   //保存下一条交易记录的变量
    //读入第一条交易记录，并确保有数据可以处理
    if (std::cin >> total){
        Sales_item trans;   //保存和的变量
        //读入并处理剩余交易记录
        while(std::cin >> trans){
            //如果我们仍在处理相同的书
            if (total.isbin() == trans.isbin()){
                total += trans;   //更新总销售额
            }
            else{
                //打印前一本书的结果
                std::cout << total << std::endl;
                total = trans;   // total现在表示下一本书的销售额
            }
        }
        std::cout << total << std::endl;// 打印最后一本书的结果
    }
    else{
        //没有输入！警告读者
        std::cerr << "No data?!" << std::endl;
        return -1;    //表示失败
    }
    return 0;
}
```


这是到目前为止我们看到的最复杂的程序了，但它所使用的都是我们已经见过的语言特性。

与往常一样，首先包含要使用的头文件：来自标准库的`iostream`和自己定义的 `Sales_item.h`。在 `main` 中，我们定义了一个名为`total`的变量，用来保存一个给定的 ISBN 的数据之和。我们首先读取第一条销售记录，存入 total 中，并检测这次读取操作是否成功。如果读取失败，则意味着没有任何销售记录，于是直接跳到最外层的 else 分支，打印一条警告信息，告诉用户没有输入。

假定已经成功读取了一条销售记录，我们继续执行最外层 `if` 之后的语句块。这个语句块首先定义一个名为 `trans` 的对象，它保存读取的销售记录。接下来的 `while` 语句将读取剩下的所有销售记录，与我们之前的程序一样，`while` 条件是一个从标准输入读取值的操作。在本例中，我们读取一个 `Sales_item` 对象，存入 `trans` 中。只要读取成功， 就执行 `while` 循环体。

`while` 的循环体是一个单个的 `if` 语句，它检查 ISBN 是否相等。如果相等，使用复合赋值运算符将`trans`加到`total`中。如果 ISBN 不等，我们打印保存在 `total` 中的 值，并将其重置为 `trans` 的值。在执行完 `if` 语句后，返回到 `while` 的循环条件，读取下一条销售记录，如此反复，直至所有销售记录都处理完。

当 `while` 语句终止时，`total` 保存着文件中最后一个 ISBN 的数据。我们在语句块 的最后一条语句中打印这最后一个 ISBN的 `total` 值，至此最外层 `if` 语句就结束了。


### 1.6 节练习

练习 1.25:借助网站上的 `Sales_item.h` 头文件，编译并运行本节给出的书店程序。
