---
title: 02 äºŒè¿›åˆ¶æ•°æ®æ ¼å¼
toc: true
date: 2018-07-08 13:50:11
---

# 6.2 Binary Data Formats (äºŒè¿›åˆ¶æ•°æ®æ ¼å¼)

æœ€ç®€å•çš„ä»¥äºŒè¿›åˆ¶çš„æ ¼å¼æ¥å­˜å‚¨æ•°æ®çš„æ–¹æ³•ï¼ˆä¹Ÿè¢«å«åšserializationï¼Œåºåˆ—åŒ–ï¼‰ï¼Œå°±æ˜¯ç”¨pythonå†…å»ºçš„pickleã€‚æ‰€æœ‰çš„pandas objectéƒ½æœ‰ä¸€ä¸ªto_pickleæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨æ•°æ®ä¸ºpickleæ ¼å¼ï¼š


```python
import pandas as pd
import numpy as np
```


```python
frame = pd.read_csv('../examples/ex1.csv')
frame
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
      <th>d</th>
      <th>message</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>hello</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>world</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9</td>
      <td>10</td>
      <td>11</td>
      <td>12</td>
      <td>foo</td>
    </tr>
  </tbody>
</table>
</div>




```python
frame.to_pickle('../examples/frame_pickle')
```


```python
!ls ../examples/
```

    array_archive.npz          [31mmacrodata.csv[m[m

    array_compressed.npz       mydata.csv

    [31marray_ex.txt[m[m               [31mout.csv[m[m

    [31mcsv_mindex.csv[m[m             [31msegismundo.txt[m[m

    [31mex1.csv[m[m                    sink.txt

    [31mex1.xlsx[m[m                   some_array.npy

    [31mex2.csv[m[m                    [31mspx.csv[m[m

    [31mex3.csv[m[m                    [31mstinkbug.png[m[m

    [31mex3.txt[m[m                    [31mstock_px.csv[m[m

    [31mex4.csv[m[m                    [31mstock_px_2.csv[m[m

    [31mex5.csv[m[m                    [31mtest_file.csv[m[m

    [31mex6.csv[m[m                    [31mtips.csv[m[m

    [31mex7.csv[m[m                    tmp.txt

    [31mexample.json[m[m               [31mtseries.csv[m[m

    [31mfdic_failed_bank_list.html[m[m [31mvolume.csv[m[m

    frame_pickle               [31myahoo_price.pkl[m[m

    [31mipython_bug.py[m[m             [31myahoo_volume.pkl[m[m



ç”¨å†…å»ºçš„pickleå¯ä»¥ç›´æ¥è¯»å–ä»»ä½•pickleæ–‡ä»¶ï¼Œæˆ–è€…ç›´æ¥ç”¨pandas.read_pickle:


```python
pd.read_pickle('../examples/frame_pickle')
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
      <th>d</th>
      <th>message</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>hello</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>world</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9</td>
      <td>10</td>
      <td>11</td>
      <td>12</td>
      <td>foo</td>
    </tr>
  </tbody>
</table>
</div>



æ³¨æ„ï¼špickleåªæ¨èç”¨äºçŸ­æœŸå­˜å‚¨ã€‚å› ä¸ºè¿™ç§æ ¼å¼æ— æ³•ä¿è¯é•¿æœŸç¨³å®šï¼›æ¯”å¦‚ä»Šå¤©pickledçš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯èƒ½åœ¨åº“æ–‡ä»¶æ›´æ–°åæ— æ³•è¯»å–ã€‚

pythonè¿˜æ”¯æŒå¦å¤–ä¸¤ç§äºŒè¿›åˆ¶æ•°æ®æ ¼å¼ï¼šHDF5å’ŒMessagePackã€‚ä¸‹é¢ä¼šä»‹ç»ä¸€ä¸ªHDF5ï¼Œä½†æ˜¯æˆ‘ä»¬é¼“åŠ±ä½ å¤šå°è¯•ä¸€ä¸ªä¸åŒçš„æ–‡ä»¶æ ¼å¼ï¼Œçœ‹çœ‹ä»–ä»¬èƒ½æœ‰å¤šå¿«ï¼Œæ˜¯å¦ç¬¦åˆä½ æ•°æ®åˆ†æçš„è¦æ±‚ã€‚å¦å¤–ä¸€äº›å¯ç”¨çš„å­˜å‚¨æ ¼å¼æœ‰ï¼šbcolz å’Œ Featherã€‚

# 1 Using HDF5 Format

HDF5æ ¼å¼æ˜¯ç”¨æ¥å­˜å‚¨å¤§é‡çš„ç§‘å­¦æ•°ç»„æ•°æ®çš„ã€‚è¿™ç§æ ¼å¼è¿˜èƒ½ç”¨äºå…¶ä»–ä¸€äº›è¯­è¨€ã€‚å…¶ä¸­HDFè¡¨ç¤ºhierarchical data formatã€‚æ¯ä¸€ä¸ªHDF5æ ¼å¼èƒ½æ˜¥åˆå¤šä¸ªæ•°æ®é›†ï¼Œå¹¶æ”¯æŒmetadataã€‚

> å…ƒæ•°æ®(meta data)â€”â€”â€œdata about dataâ€ å…³äºæ•°æ®çš„æ•°æ®ï¼Œä¸€èˆ¬æ˜¯ç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚å­˜å‚¨åœ¨æ•°æ®åº“é‡Œçš„æ•°æ®ï¼Œè§„å®šäº†å­—æ®µçš„é•¿åº¦ã€ç±»å‹ç­‰ï¼‰ã€‚å…ƒæ•°æ®æ˜¯æŒ‡ä»ä¿¡æ¯èµ„æºä¸­æŠ½å–å‡ºæ¥çš„ç”¨äºè¯´æ˜å…¶ç‰¹å¾ã€å†…å®¹çš„ç»“æ„åŒ–çš„æ•°æ®(å¦‚é¢˜å,ç‰ˆæœ¬ã€å‡ºç‰ˆæ•°æ®ã€ç›¸å…³è¯´æ˜,åŒ…æ‹¬æ£€ç´¢ç‚¹ç­‰)ï¼Œç”¨äºç»„ç»‡ã€æè¿°ã€æ£€ç´¢ã€ä¿å­˜ã€ç®¡ç†ä¿¡æ¯å’ŒçŸ¥è¯†èµ„æºã€‚

HDF5 æ”¯æŒå¤šç§å‹ç¼©æ¨¡å¼çš„on-the-fly compressionï¼ˆå³æ—¶å‹ç¼©ï¼‰ï¼Œèƒ½è®©æ•°æ®ä¸­ä¸€äº›é‡å¤çš„éƒ¨åˆ†å­˜å‚¨åœ°æ›´æœ‰æ•ˆã€‚HDF5å¯¹äºå¤„ç†å¤§æ•°æ®é›†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå› ä¸ºä»–ä¸ä¼šæŠŠæ‰€æœ‰æ•°æ®ä¸€æ¬¡æ€§è¯»å–åˆ°å†…å­˜é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä»å¾ˆå¤§çš„æ•°ç»„ä¸­æœ‰æ•ˆç‡åœ°è¯»å–ä¸€å°éƒ¨åˆ†ã€‚

èƒ½ç”¨PyTablesæˆ–h5pyæ¥è®¿é—®HDF5æ•°æ®ï¼Œpandasä¹Ÿæœ‰æä¾›ä¸€ä¸ªhigh-levelçš„äº¤äº’ç•Œé¢ã€‚HDFStoreç±»åƒdictä¸€æ ·èƒ½ç”¨æ¥å¤„ç†low-levelç»†èŠ‚ï¼š



```python
frame = pd.DataFrame({'a': np.random.randn(100)})

store = pd.HDFStore('../examples/mydata.h5')
```


```python
frame.head()
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.908968</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.589368</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.015493</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.029850</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.682180</td>
    </tr>
  </tbody>
</table>
</div>




```python
cat ../examples/mydata.csv
```

    one;two;three

    1;2;3

    4;5;6

    7;8;9




```python
store['obj1'] = frame

store['obj1_col'] = frame['a']

store
```




    <class 'pandas.io.pytables.HDFStore'>
    File path: ../examples/mydata.h5
    /obj1                frame        (shape->[100,1])
    /obj1_col            series       (shape->[100])



HDF5ä¸­çš„objectèƒ½ç”¨åƒdictä¸€æ ·çš„APIæ¥æå–ï¼š


```python
store['obj1']
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.908968</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.589368</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.015493</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.029850</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.682180</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-0.977549</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.806008</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.458852</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.833007</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.410430</td>
    </tr>
    <tr>
      <th>10</th>
      <td>-0.232093</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.002657</td>
    </tr>
    <tr>
      <th>12</th>
      <td>-0.642136</td>
    </tr>
    <tr>
      <th>13</th>
      <td>-1.772356</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.411567</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1.259846</td>
    </tr>
    <tr>
      <th>16</th>
      <td>-0.730757</td>
    </tr>
    <tr>
      <th>17</th>
      <td>-1.401318</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2.984850</td>
    </tr>
    <tr>
      <th>19</th>
      <td>-0.140144</td>
    </tr>
    <tr>
      <th>20</th>
      <td>-0.972235</td>
    </tr>
    <tr>
      <th>21</th>
      <td>-0.592930</td>
    </tr>
    <tr>
      <th>22</th>
      <td>1.538674</td>
    </tr>
    <tr>
      <th>23</th>
      <td>-0.052034</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.260698</td>
    </tr>
    <tr>
      <th>25</th>
      <td>-0.859609</td>
    </tr>
    <tr>
      <th>26</th>
      <td>1.119075</td>
    </tr>
    <tr>
      <th>27</th>
      <td>-0.898982</td>
    </tr>
    <tr>
      <th>28</th>
      <td>0.191869</td>
    </tr>
    <tr>
      <th>29</th>
      <td>1.013184</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>70</th>
      <td>0.507719</td>
    </tr>
    <tr>
      <th>71</th>
      <td>-0.146967</td>
    </tr>
    <tr>
      <th>72</th>
      <td>0.694807</td>
    </tr>
    <tr>
      <th>73</th>
      <td>-0.482966</td>
    </tr>
    <tr>
      <th>74</th>
      <td>1.816455</td>
    </tr>
    <tr>
      <th>75</th>
      <td>0.535113</td>
    </tr>
    <tr>
      <th>76</th>
      <td>-1.006997</td>
    </tr>
    <tr>
      <th>77</th>
      <td>2.088429</td>
    </tr>
    <tr>
      <th>78</th>
      <td>-0.449548</td>
    </tr>
    <tr>
      <th>79</th>
      <td>1.133784</td>
    </tr>
    <tr>
      <th>80</th>
      <td>0.413018</td>
    </tr>
    <tr>
      <th>81</th>
      <td>0.324538</td>
    </tr>
    <tr>
      <th>82</th>
      <td>1.434230</td>
    </tr>
    <tr>
      <th>83</th>
      <td>0.767194</td>
    </tr>
    <tr>
      <th>84</th>
      <td>2.073305</td>
    </tr>
    <tr>
      <th>85</th>
      <td>-2.643750</td>
    </tr>
    <tr>
      <th>86</th>
      <td>2.330771</td>
    </tr>
    <tr>
      <th>87</th>
      <td>-1.683786</td>
    </tr>
    <tr>
      <th>88</th>
      <td>1.631209</td>
    </tr>
    <tr>
      <th>89</th>
      <td>0.036383</td>
    </tr>
    <tr>
      <th>90</th>
      <td>0.755447</td>
    </tr>
    <tr>
      <th>91</th>
      <td>-0.712269</td>
    </tr>
    <tr>
      <th>92</th>
      <td>-0.914963</td>
    </tr>
    <tr>
      <th>93</th>
      <td>-0.660928</td>
    </tr>
    <tr>
      <th>94</th>
      <td>1.465104</td>
    </tr>
    <tr>
      <th>95</th>
      <td>0.101968</td>
    </tr>
    <tr>
      <th>96</th>
      <td>0.669502</td>
    </tr>
    <tr>
      <th>97</th>
      <td>-0.210062</td>
    </tr>
    <tr>
      <th>98</th>
      <td>-0.453599</td>
    </tr>
    <tr>
      <th>99</th>
      <td>0.848008</td>
    </tr>
  </tbody>
</table>
<p>100 rows Ã— 1 columns</p>
</div>



HDFStoreæ”¯æŒä¸¤ç§å­˜å‚¨æ¶æ„ï¼Œfixedå’Œtableã€‚åè€…é€šå¸¸æ›´æ…¢ä¸€äº›ï¼Œä½†æ”¯æŒæŸ¥è¯¢æ“ä½œï¼š


```python
store.put('obj2', frame, format='table')
```


```python
store.select('obj2', where=['index >= 10 and index <= 15'])
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>-1.186667</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.628998</td>
    </tr>
    <tr>
      <th>12</th>
      <td>-0.668921</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.775731</td>
    </tr>
    <tr>
      <th>14</th>
      <td>-1.329899</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1.920832</td>
    </tr>
  </tbody>
</table>
</div>



putæ˜¯å­˜å‚¨çš„å¦ä¸€ç§å†™æ³•ï¼Œç±»ä¼¼äºä¹‹å‰çš„`store['obj2'] = frame`ï¼Œä½†è¿™ç§åé˜²èƒ½è®©æˆ‘ä»¬è®¾ç½®å­˜å‚¨æ ¼å¼ã€‚

pandas.read_hdfå‡½æ•°ä¹Ÿå¾ˆæ–¹ä¾¿ï¼š


```python
frame.to_hdf('../examples/mydata.h5', 'obj3', format='table')
```


```python
pd.read_hdf('../examples/mydata.h5', 'obj3', where=['index < 5'])
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.324210</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.770813</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.554799</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.741867</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.875071</td>
    </tr>
  </tbody>
</table>
</div>



æ³¨æ„ï¼šå¦‚æœæˆ‘ä»¬æ˜¯æŠŠæ•°æ®å­˜åœ¨è¿œç«¯æœåŠ¡å™¨ä¸Šï¼Œæ¯”å¦‚Amazon S3æˆ–HDFSï¼Œä½¿ç”¨ä¸€äº›ä¸ºåˆ†å¸ƒå¼å­˜å‚¨å®é™…çš„äºŒè¿›åˆ¶æ ¼å¼ä¼šæ›´é€‚åˆä¸€äº›ï¼Œæ¯”å¦‚Apache Parquetã€‚

å¦‚æœæ˜¯åœ¨æœ¬åœ°å¤„ç†å¾ˆå¤§æ•°æ®é‡çš„è¯ï¼Œæ¨èå°è¯•PyTableså’Œh5pyçœ‹æ˜¯å¦ç¬¦åˆä½ çš„è¦æ±‚ã€‚å› ä¸ºå¾ˆå¤šæ•°æ®åˆ†æé—®é¢˜éƒ½å—é™äºI/Oï¼Œæ‰€ä»¥ç”¨HDF5è¿™æ ·çš„å·¥å…·èƒ½åŠ å¿«åº”ç”¨ã€‚

æ³¨æ„ï¼šHDF5ä¸æ˜¯æ•°æ®åº“ï¼ˆdatabaseï¼‰ã€‚å®ƒæœ€é€‚åˆä¸€æ¬¡å†™å…¥ï¼Œå¤šæ¬¡è¯»å–çš„æ•°æ®åº“ã€‚å°½ç®¡æ•°æ®å¯ä»¥åœ¨ä»»ä½•æ—¶é—´å¤šæ¬¡å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœå¤šä¸ªä½¿ç”¨è€…åŒæ—¶å†™å…¥çš„è¯ï¼Œæ–‡ä»¶ä¼šè¢«ç ´åã€‚

# 2 Reading Microsoft Excel Filesï¼ˆè¯»å–å¾®è½¯çš„excelæ–‡ä»¶ï¼‰

pandasæ”¯æŒè¯»å–è¡¨æ ¼å‹æ•°æ®ï¼ˆexcel 2003æˆ–æ›´é«˜ï¼‰æ–‡ä»¶ï¼Œä½¿ç”¨ExcelFile classæˆ–pandas.read_excelå‡½æ•°ã€‚è¿™äº›å·¥å…·éœ€è¦ä¸€äº›å¯Œå®¶çš„åŒ…xlrdå’Œopenpyxlæ¥åˆ†åˆ«è¯»å–XLSå’ŒXLSXæ–‡ä»¶ã€‚ä½ å¯ä»¥é€šè¿‡pipæˆ–condaæ¥å®‰è£…ã€‚

ä½¿ç”¨ExcelFileï¼Œåˆ›å»ºä¸€ä¸ªinstanceï¼Œé€šè¿‡ç»™xlsæˆ–xlsxä¸€ä¸ªè·¯å¾„ï¼š


```python
xlsx = pd.ExcelFile('../examples/ex1.xlsx')
```

ä¿å­˜åœ¨sheeté‡Œçš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡parseæ¥è¯»å–ä¸ºDataFrameï¼š


```python
pd.read_excel(xlsx, 'Sheet1')
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
      <th>d</th>
      <th>message</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>hello</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>world</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9</td>
      <td>10</td>
      <td>11</td>
      <td>12</td>
      <td>foo</td>
    </tr>
  </tbody>
</table>
</div>



å¦‚æœè¦è¯»å–ä¸€ä¸ªæ–‡ä»¶ä¸­çš„å¤šä¸ªsheetï¼Œç”¨ExcelFileä¼šæ›´å¿«ã€‚ä½†è®©ï¼Œä½ ä¹Ÿèƒ½æŠŠæ–‡ä»¶åç›´æ¥ä¼ é€’ç»™pandas.read_excel:


```python
frame = pd.read_excel('../examples/ex1.xlsx', 'Sheet1')
frame
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
      <th>d</th>
      <th>message</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>hello</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>world</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9</td>
      <td>10</td>
      <td>11</td>
      <td>12</td>
      <td>foo</td>
    </tr>
  </tbody>
</table>
</div>



å¦‚æœè¦æŠŠpandasæ•°æ®å†™ä¸ºExcelæ ¼å¼ï¼Œä½ å¿…é¡»å…ˆåˆ›å»ºä¸€ä¸ªExcelWriteï¼Œç„¶åç”¨to_excelæ–¹æ³•ï¼š


```python
writer = pd.ExcelWriter('../examples/ex2.xlsx')
```


```python
frame.to_excel(writer, 'Sheet1')
```


```python
writer.save()
```

å¦‚æœä¸é€‚ç”¨ExcelWriterçš„è¯ï¼Œå¯ä»¥ç›´æ¥ä¼ ç»™to_excelä¸€ä¸ªpathï¼š


```python
frame.to_excel('../examples/ex2.xlsx')
```
