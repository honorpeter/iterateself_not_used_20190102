<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>09 åŒæœºçƒ­å¤‡ - è¿­ä»£è‡ªå·±</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="iterateself" />
  <meta name="description" content="ï¼œå¥´æŠ“çƒ­ç•* åœ¨äº’è”ç½‘é«˜é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œå°¤å…¶æ˜¯ç”µå­å•†åŠ¡çš„å‘å±•ï¼Œè¦æ±‚æœåŠ¡å™¨èƒ½å¤Ÿæä¾›ä¸é—´æ–­æœåŠ¡ã€‚åœ¨ ç”µå­å•†åŠ¡ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨å®•æœºï¼Œé€ æˆçš„æŸå¤±æ˜¯ä¸å¯ä¼°é‡çš„" />

  <meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.47.1" />


<link rel="canonical" href="http://iterate.site/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/03-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/05-%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91/01-%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/02-linux-%E7%8E%AF%E5%A2%83/centos7-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/09-%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link href="/dist/even.min.css?v=3.2.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="09 åŒæœºçƒ­å¤‡" />
<meta property="og:description" content="ï¼œå¥´æŠ“çƒ­ç•* åœ¨äº’è”ç½‘é«˜é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œå°¤å…¶æ˜¯ç”µå­å•†åŠ¡çš„å‘å±•ï¼Œè¦æ±‚æœåŠ¡å™¨èƒ½å¤Ÿæä¾›ä¸é—´æ–­æœåŠ¡ã€‚åœ¨ ç”µå­å•†åŠ¡ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨å®•æœºï¼Œé€ æˆçš„æŸå¤±æ˜¯ä¸å¯ä¼°é‡çš„" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://iterate.site/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/03-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/05-%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91/01-%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/02-linux-%E7%8E%AF%E5%A2%83/centos7-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/09-%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87/" /><meta property="article:published_time" content="2018-06-27T07:04:58&#43;00:00"/>
<meta property="article:modified_time" content="2018-06-27T07:04:58&#43;00:00"/>
<meta itemprop="name" content="09 åŒæœºçƒ­å¤‡">
<meta itemprop="description" content="ï¼œå¥´æŠ“çƒ­ç•* åœ¨äº’è”ç½‘é«˜é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œå°¤å…¶æ˜¯ç”µå­å•†åŠ¡çš„å‘å±•ï¼Œè¦æ±‚æœåŠ¡å™¨èƒ½å¤Ÿæä¾›ä¸é—´æ–­æœåŠ¡ã€‚åœ¨ ç”µå­å•†åŠ¡ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨å®•æœºï¼Œé€ æˆçš„æŸå¤±æ˜¯ä¸å¯ä¼°é‡çš„">


<meta itemprop="datePublished" content="2018-06-27T07:04:58&#43;00:00" />
<meta itemprop="dateModified" content="2018-06-27T07:04:58&#43;00:00" />
<meta itemprop="wordCount" content="9432">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="09 åŒæœºçƒ­å¤‡"/>
<meta name="twitter:description" content="ï¼œå¥´æŠ“çƒ­ç•* åœ¨äº’è”ç½‘é«˜é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œå°¤å…¶æ˜¯ç”µå­å•†åŠ¡çš„å‘å±•ï¼Œè¦æ±‚æœåŠ¡å™¨èƒ½å¤Ÿæä¾›ä¸é—´æ–­æœåŠ¡ã€‚åœ¨ ç”µå­å•†åŠ¡ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨å®•æœºï¼Œé€ æˆçš„æŸå¤±æ˜¯ä¸å¯ä¼°é‡çš„"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">è¿­ä»£è‡ªå·±</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">ä¸»é¡µ</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">å½’æ¡£</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">å…³äº</li>
      </a><a href="/catalog/">
        <li class="mobile-menu-item">ç›®å½•</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">è¿­ä»£è‡ªå·±</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">ä¸»é¡µ</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">å½’æ¡£</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">å…³äº</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/catalog/">ç›®å½•</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">09 åŒæœºçƒ­å¤‡</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-06-27 </span>
        
        <span class="more-meta"> 9432 words </span>
        <span class="more-meta"> 19 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  
  <div class="post-toc-content">
    
  </div>
</div>

    
    

    
    <div class="post-content">
      <p>ï¼œå¥´æŠ“çƒ­ç•*</p>

<p>åœ¨äº’è”ç½‘é«˜é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œå°¤å…¶æ˜¯ç”µå­å•†åŠ¡çš„å‘å±•ï¼Œè¦æ±‚æœåŠ¡å™¨èƒ½å¤Ÿæä¾›ä¸é—´æ–­æœåŠ¡ã€‚åœ¨ ç”µå­å•†åŠ¡ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨å®•æœºï¼Œé€ æˆçš„æŸå¤±æ˜¯ä¸å¯ä¼°é‡çš„ã€‚è¦ä¿è¯æœåŠ¡å™¨ä¸é—´æ–­æœåŠ¡ï¼Œå°±éœ€è¦ å¯¹æœåŠ¡å™¨å®ç°å†—ä½™ã€‚åœ¨ä¼—å¤šçš„å®ç°æœåŠ¡å™¨å†—ä½™çš„è§£å†³æ–¹æ¡ˆä¸­ï¼ŒPacemakerä¸ºæˆ‘ä»¬æä¾›äº†å»‰ä»·çš„ã€ å¯ä¼¸ç¼©çš„é«˜å¯ç”¨é›†ç¾¤æ–¹æ¡ˆã€‚</p>

<p>æœ¬ç« é¦–å…ˆä»‹ç»é«˜å¯ç”¨æ€§é›†ç¾¤æŠ€æœ¯ï¼Œç„¶åä»‹ç»é«˜å¯ç”¨è½¯ä»¶Pacemakerå’Œkeepalivedçš„æ­å»ºä¸ åº”ç”¨ã€‚</p>

<p>æœ¬ç« ä¸»è¦æ¶‰åŠçš„çŸ¥è¯†ç‚¹æœ‰ï¼š</p>

<p>â€¢    é«˜å¯ç”¨æ€§é›†ç¾¤æŠ€æœ¯</p>

<p>â€¢    åŒæœºçƒ­å¤‡è½¯ä»¶Pacemakerçš„åº”ç”¨</p>

<p>â€¢    åŒæœºçƒ­å¤‡è½¯ä»¶keepalivedçš„åº”ç”¨</p>

<p>9.1é«˜å¯ç”¨æ€§é›†ç¾¤æŠ€æœ¯</p>

<p>éšç€äº’è”ç½‘çš„å¢é•¿ï¼Œäº’è”ç½‘å·²ç»æˆä¸ºäººä»¬ç”Ÿæ´»ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¯¹ç½‘ç»œçš„ä¾èµ–ä¸æ–­å¢—åŠ ï¼Œç”µå­ å•†åŠ¡ä½¿å¾—è®¢å•ä¸€å¤©24å°æ—¶ä¸é—´æ–­åœ°è¿›è¡Œæˆä¸ºå¯èƒ½ã€‚å¦‚æœæœåŠ¡å™¨å®•æœºï¼Œé€ æˆçš„æŸå¤±æ˜¯ä¸å¯ä¼°é‡ çš„ã€‚æ¯ä¸€åˆ†é’Ÿçš„å®•æœºéƒ½æ„å‘³ç€æ”¶å…¥ã€ç”Ÿäº§å’Œåˆ©æ¶¦çš„æŸå¤±ï¼Œç”šè‡³å¸‚åœºåœ°ä½çš„å‰Šå¼±ã€‚è¦ä¿è¯æœåŠ¡å™¨ ä¸é—´æ–­æœåŠ¡ï¼Œå°±éœ€è¦å¯¹æœåŠ¡å™¨å®ç°å†—ä½™ã€‚æ–°çš„ç½‘ç»œåº”ç”¨ä½¿å¾—å„ä¸ªæœåŠ¡çš„æä¾›è€…å¯¹è®¡ç®—æœºçš„è¦æ±‚ è¾¾åˆ°äº†ç©ºå‰çš„ç¨‹åº¦ï¼Œç”µå­å•†åŠ¡éœ€è¦è¶Šæ¥è¶Šç¨³å®šå¯é çš„æœåŠ¡ç³»ç»Ÿã€‚</p>

<p>9.1.1å¯ç”¨æ€§å’Œé›†ç¾¤</p>

<p>å¯ç”¨æ€§æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿä¿æŒåœ¨çº¿å¹¶ä¸”å¯ä¾›è®¿é—®ï¼Œæœ‰å¾ˆå¤šå› ç´ ä¼šé€ æˆç³»ç»Ÿå®•æœºï¼ŒåŒ…æ‹¬ä¸ºäº†ç»´æŠ¤ è€Œæœ‰è®¡åˆ’çš„å®•æœºä»¥åŠæ„å¤–æ•…éšœç­‰ï¼Œé«˜å¯ç”¨æ€§æ–¹æ¡ˆçš„ç›®æ ‡å°±æ˜¯ä½¿å®•æœºæ—¶é—´ä»¥åŠæ•…éšœæ¢å¤æ—¶é—´æœ€å° åŒ–ï¼Œé«˜å¯ç”¨æ€§é›†ç¾¤ï¼ŒåŸä¹‰ä¸ºHigh Availability Cluster,ç®€ç§°HA Cluster,æ˜¯æŒ‡ä»¥å‡å°‘æœåŠ¡ä¸­æ–­</p>

<p>ï¼ˆå®•æœºï¼‰æ—¶é—´ä¸ºç›®çš„çš„æœåŠ¡å™¨é›†ç¾¤æŠ€æœ¯ã€‚</p>

<p>æ‰€è°“é›†ç¾¤ï¼Œæ˜¯æä¾›ç›¸åŒç½‘ç»œèµ„æºçš„ä¸€ç»„è®¡ç®—æœºç³»ç»Ÿã€‚å…¶ä¸­çš„æ¯ä¸€å°æä¾›æœåŠ¡çš„è®¡ç®—æœºï¼Œå¯ ä»¥ç§°ä¹‹ä¸ºèŠ‚ç‚¹ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨æˆ–æ¥ä¸åŠå¤„ç†å®¢æˆ·çš„è¯·æ±‚æ—¶ï¼Œè¯¥è¯·æ±‚å°†ä¼šè½¬åˆ°å¦å¤–çš„å¯ç”¨èŠ‚ ç‚¹æ¥å¤„ç†ã€‚å¯¹äºå®¢æˆ·ç«¯åº”ç”¨æ¥è¯´ï¼Œä¸å¿…å…³å¿ƒèµ„æºè°ƒåº¦çš„ç»†èŠ‚ï¼Œæ‰€æœ‰è¿™äº›æ•…éšœå¤„ç†æµç¨‹é›†ç¾¤ç³»ç»Ÿ å¯ä»¥è‡ªåŠ¨å®Œæˆã€‚</p>

<p>é›†ç¾¤ä¸­èŠ‚ç‚¹å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼æ¥è¿è¡Œï¼Œæ¯”å¦‚åŒæ—¶æä¾›æœåŠ¡æˆ–åªæœ‰å…¶ä¸­ä¸€äº›èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œ å¦å¤–ä¸€äº›èŠ‚ç‚¹å¤„äºç­‰å¾…çŠ¶æ€ã€‚åŒæ—¶æä¾›æœåŠ¡çš„èŠ‚ç‚¹ï¼Œæ‰€æœ‰æœåŠ¡å™¨éƒ½åŒæ—¶å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸ŠåŒæ—¶è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œç›‘æ§ç¨‹åºå¯ä»¥è‡ªåŠ¨å‰”é™¤æ­¤èŠ‚ç‚¹ï¼Œè€Œ å®¢æˆ·ç«¯è§‰å¯Ÿä¸åˆ°è¿™äº›å˜åŒ–ã€‚å¤„äºæ¿€æ´»çŠ¶æ€çš„èŠ‚ç‚¹åœ¨æ•…éšœæ—¶ç”±å¤‡èŠ‚ç‚¹éšæ—¶æ¥ç®¡ï¼Œç”±äºå¹³æ—¶åªæœ‰ä¸€ äº›èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå¯èƒ½ä¼šå½±å“åº”ç”¨çš„æ€§èƒ½ã€‚åœ¨æ­£å¸¸æ“ä½œæ—¶ï¼Œå¦ä¸€ä¸ªèŠ‚ç‚¹å¤„äºå¤‡ç”¨çŠ¶æ€ï¼Œåªæœ‰å½“ æ´»åŠ¨çš„èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¯¥å¤‡ç”¨èŠ‚ç‚¹æ‰ä¼šæ¥ç®¡å·¥ä½œï¼Œä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆç»æµçš„æ–¹æ¡ˆï¼Œå› ä¸ºåº”ç”¨å¿… é¡»åŒæ—¶é‡‡ç”¨ä¸¤ä¸ªæœåŠ¡å™¨æ¥å®ŒæˆåŒæ ·çš„äº‹æƒ…ã€‚è™½ç„¶å½“å‡ºç°æ•…éšœæ—¶ä¸ä¼šå¯¹åº”ç”¨ç¨‹åºäº§ç”Ÿä»»ä½•å½±å“ï¼Œ ä½†æ­¤ç§æ–¹æ¡ˆçš„æ€§ä»·æ¯”å¹¶ä¸é«˜ã€‚</p>

<p>9.1.2é›†ç¾¤çš„åˆ†ç±»</p>

<p>ä»å·¥ä½œæ–¹å¼å‡ºå‘ï¼Œé›†ç¾¤åˆ†ä¸ºä¸‹é¢3ç§ï¼š</p>

<p>(1)    ä¸»/ä¸»</p>

<p>è¿™æ˜¯æœ€å¸¸è§çš„é›†ç¾¤æ¨¡å‹ï¼Œæä¾›äº†é«˜å¯ç”¨æ€§ï¼Œè¿™ç§é›†ç¾¤å¿…é¡»ä¿è¯åœ¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ—¶å¯ä»¥æä¾› æœåŠ¡ï¼Œæä¾›å®¢æˆ·å¯ä»¥æ¥å—çš„æ€§èƒ½ã€‚è¯¥æ¨¡å‹æœ€å¤§ç¨‹åº¦åœ°åˆ©ç”¨æœåŠ¡å™¨è½¯ç¡¬ä»¶èµ„æºã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½é€š è¿‡ç½‘ç»œå¯¹å®¢æˆ·æœºæä¾›ç½‘ç»œæœåŠ¡ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥åœ¨æ•…éšœè½¬ç§»æ—¶ä¸´æ—¶æ¥ç®¡å¦ä¸€ä¸ªèŠ‚ç‚¹çš„å·¥ä½œã€‚ æ‰€æœ‰çš„æœåŠ¡åœ¨æ•…éšœè½¬ç§»åä»ä¿æŒå¯ç”¨ï¼Œè€Œåç«¯çš„å®ç°å®¢æˆ·ç«¯å¹¶ä¸ç”¨å…³å¿ƒï¼Œæ‰€æœ‰åç«¯çš„å·¥ä½œå¯¹ å®¢æˆ·ç«¯æ˜¯é€æ˜çš„ã€‚</p>

<p>(2)    ä¸»/ä»</p>

<p>ä¸ä¸»/ä¸»æ¨¡å‹ä¸åŒï¼Œé™äºä¸šåŠ¡ç‰¹æ€§ï¼Œä¸»/ä»æ¨¡å‹éœ€è¦ä¸€ä¸ªèŠ‚ç‚¹å¤„äºæ­£å¸¸æœåŠ¡çŠ¶æ€ï¼Œè€Œå¦å¤–ä¸€ ä¸ªèŠ‚ç‚¹å¤„äºå¤‡ç”¨çŠ¶æ€ã€‚ä¸»èŠ‚ç‚¹å¤„ç†å®¢æˆ·æœºçš„è¯·æ±‚ï¼Œè€Œå¤‡ç”¨èŠ‚ç‚¹å¤„äºç©ºé—²çŠ¶æ€ï¼Œå½“ä¸»èŠ‚ç‚¹å‡ºç°æ•… éšœæ—¶ï¼Œå¤‡ç”¨èŠ‚ç‚¹ä¼šæ¥ç®¡ä¸»èŠ‚ç‚¹çš„å·¥ä½œï¼Œç»§ç»­ä¸ºå®¢æˆ·æœºæä¾›æœåŠ¡ï¼Œå¹¶ä¸”ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½ä¸Šå½±å“ã€‚</p>

<p>(3)    æ··åˆå‹</p>

<p>æ··åˆå‹æ˜¯ä¸Šé¢ä¸¤ç§æ¨¡å‹çš„ç»“åˆï¼Œå¯ä»¥å®ç°åªé’ˆå¯¹å…³é”®åº”ç”¨è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œè¿™æ ·å¯ä»¥å¯¹è¿™äº› åº”ç”¨å®ç°å¯ç”¨æ€§çš„åŒæ—¶è®©éå…³é”®çš„åº”ç”¨åœ¨æ­£å¸¸è¿ä½œæ—¶ä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚å½“å‡ºç°æ•…éšœæ—¶, å‡ºç°æ•…éšœçš„æœåŠ¡å™¨ä¸Šçš„ä¸å¤ªå…³é”®çš„åº”ç”¨å°±ä¸å¯ç”¨äº†ï¼Œä½†æ˜¯é‚£äº›å…³é”®åº”ç”¨ä¼šè½¬ç§»åˆ°å¦ä¸€ä¸ªå¯ç”¨çš„ èŠ‚ç‚¹ä¸Šï¼Œä»è€Œè¾¾åˆ°æ€§èƒ½å’Œå®¹ç¾ä¸¤æ–¹é¢çš„å¹³è¡¡ã€‚</p>

<p>èµ›I    åŒæœºçƒ­å¤‡å¼€æºè½¯ä»¶Pacemaker</p>

<p>éšç€åº”ç”¨çš„ç”¨æˆ·é‡å¢é•¿ï¼Œæˆ–åœ¨ä¸€äº›ç³»ç»Ÿå…³é”®åº”ç”¨ä¸­ï¼Œä¸ºæä¾›ä¸é—´æ–­çš„æœåŠ¡ä¿è¯ç³»ç»Ÿçš„é«˜å¯ ç”¨æ˜¯éå¸¸å¿…è¦çš„ã€‚Pacemakerå°±æ˜¯ä¸€ä¸ªç”¨äºä¿è¯æœåŠ¡é«˜å¯ç”¨æ€§çš„ç»„ä»¶ï¼Œåœ¨è¡Œä¸šå†…å¾—åˆ°äº†å¹¿æ³›åº”</p>

<p>ç”¨ã€‚æœ¬èŠ‚å°†ç®€è¦ä»‹ç»Pacemakerçš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p>

<p>9.2.1 Pacemaker æ¦‚è¿°</p>

<p>Pacemakeræ˜¯ä¸€ä¸ªé›†ç¾¤èµ„æºç®¡ç†å™¨ï¼Œä»–å¯ä»¥åˆ©ç”¨ç®¡ç†å‘˜å–œæ¬¢çš„é›†ç¾¤åŸºç¡€æ„ä»¶æä¾›çš„æ¶ˆæ¯å’Œ æˆå‘˜ç®¡ç†èƒ½åŠ›æ¥æ¢æµ‹èŠ‚ç‚¹æˆ–èµ„æºæ•…éšœï¼Œå¹¶ä»æ•…éšœä¸­æ¢å¤ï¼Œä»è€Œå®ç°é›†ç¾¤èµ„æºçš„é«˜å¯ç”¨æ€§ã€‚ä¸ä¹‹ å‰å¹¿æ³›ä½¿ç”¨çš„Heartbeatç›¸æ¯”ï¼ŒPacemakeré…ç½®æ›´ä¸ºç®€å•ï¼Œå¹¶ä¸”æ”¯æŒçš„é›†ç¾¤æ¨¡å¼å¤šæ ·ã€èµ„æºç®¡ ç†çš„æ–¹å¼æ›´åŠ çµæ´»ã€‚</p>

<p>Pacemakeræ˜¯ä¸€ä¸ªç›¸å½“åºå¤§çš„è½¯ä»¶ï¼Œå…¶å†…éƒ¨ç»“æ„å¦‚å›¾9.1æ‰€ç¤ºã€‚</p>

<p>å›¾9.1 Pacemakerå†…éƒ¨ç»“æ„</p>

<p>Pacemakerçš„ä¸»è¦ç»„ä»¶åŠä½œç”¨å¦‚ä¸‹:</p>

<p>â€¢    stonithd:å¿ƒè·³ç¨‹åºï¼Œä¸»è¦ç”¨äºå¤„ç†ä¸å¿ƒè·³ç›¸å…³çš„äº‹ä»¶ã€‚</p>

<p>â€¢    lrmd:æœ¬åœ°èµ„æºç®¡ç†ç¨‹åºï¼Œç›´æ¥è°ƒé…ç³»ç»Ÿèµ„æºã€‚</p>

<p>â€¢    pengine:æ”¿ç­–å¼•æ“ï¼Œä¾æ®å½“å‰é›†ç¾¤çŠ¶æ€è®¡ç®—ä¸‹ä¸€æ­¥åº”è¯¥æ‰§è¡Œçš„æ“ä½œç­‰ã€‚</p>

<p>â€¢    CIB:é›†ç¾¤ä¿¡æ¯åº“ï¼Œä¸»è¦åŒ…å«äº†å½“å‰é›†ç¾¤ä¸­æ‰€æœ‰çš„èµ„æºï¼ŒåŠèµ„æºä¹‹é—´çš„å…³ç³»ç­‰ã€‚</p>

<p>â€¢    CRMD:é›†ç¾¤èµ„æºç®¡ç†å®ˆæŠ¤è¿›ç¨‹ã€‚</p>

<p>Pacemakerå·¥ä½œæ—¶ä¼šæ ¹æ®CIBä¸­è®°å½•çš„èµ„æºï¼Œç”±pengineè®¡ç®—å‡ºé›†ç¾¤çš„æœ€ä½³çŠ¶æ€ï¼ŒåŠå¦‚ä½• è¾¾åˆ°è¿™ä¸ªæœ€ä½³çŠ¶æ€ï¼Œæœ€åå»ºç«‹ä¸€ä¸ªCRMDå®ä¾‹ï¼Œç”±CRMDå®ä¾‹æ¥åšå‡ºæ‰€æœ‰é›†ç¾¤å†³ç­–ã€‚è¿™æ˜¯ Pacemakerç®€è¦å·¥ä½œè¿‡ç¨‹ï¼Œè¯»è€…å¦‚éœ€è¯¦ç»†äº†è§£å…¶å·¥ä½œè¿‡ç¨‹ï¼Œå¯å‚è€ƒç›¸å…³æ–‡æ¡£äº†è§£ã€‚</p>

<p>9.2.2 Pacemakerå®‰è£…ä¸é…ç½®</p>

<p>ä¸ºä¿è¯ç³»ç»Ÿæ›´é«˜çš„å¯ç”¨æ€§ï¼Œå¸¸å¸¸éœ€è¦å¯¹é‡è¦çš„å…³é”®ä¸šåŠ¡åšåŒæœºçƒ­å¤‡ï¼Œæ¯”å¦‚ä¸€ä¸ªç®€å•çš„Web æœåŠ¡éœ€è¦åšåŒæœºçƒ­å¤‡ã€‚å¸¸è§çš„æ–¹æ¡ˆæœ‰keepalivedã€Pacemakerç­‰ï¼Œæœ¬èŠ‚ä»¥Pacemakerä¸ºä¾‹è¯´æ˜ åŒæœºçƒ­å¤‡çš„éƒ¨ç½²è¿‡ç¨‹ã€‚</p>

<p>åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼ŒPacemakeråŒæœºçƒ­å¤‡ä¿¡æ¯å¦‚è¡¨9.1æ‰€ç¤ºã€‚</p>

<p>è¡¨9.1 HeartbeatåŒæœºçƒ­å¤‡ä¿¡æ¯è¯´æ˜</p>

<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>

<tbody>
<tr>
<td>192.168.3.87</td>
<td>ä¸»èŠ‚ç‚¹    .</td>
</tr>

<tr>
<td>192.168.3.88</td>
<td>å¤‡èŠ‚ç‚¹</td>
</tr>

<tr>
<td>192.168.3.118</td>
<td>è™šæ‹ŸIP</td>
</tr>
</tbody>
</table>

<p>ç¤ºä¾‹å®ç°çš„åŠŸèƒ½ä¸ºï¼šæ­£å¸¸æƒ…å†µä¸‹ç”±192.168.3.87æä¾›æœåŠ¡ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ ¹æ®ä¸»èŠ‚ç‚¹æä¾›çš„ VIPè®¿é—®é›†ç¾¤å†…çš„å„ç§èµ„æºï¼Œå½“ä¸»èŠ‚ç‚¹æ•…éšœæ—¶å¤‡èŠ‚ç‚¹å¯ä»¥è‡ªåŠ¨æ¥ç®¡ä¸»èŠ‚ç‚¹çš„IPèµ„æºï¼Œå³VIP</p>

<p>ä¸º 192.168.3.118ã€‚</p>

<p>HAçš„éƒ¨ç½²è¦ç»è¿‡è½¯ä»¶å®‰è£…ã€ç¯å¢ƒé…ç½®ã€èµ„æºé…ç½®ç­‰å‡ ä¸ªæ­¥éª¤ï¼Œæœ¬å°èŠ‚å°†ç®€å•ä»‹ç»è½¯ä»¶å®‰ è£…å’Œç¯å¢ƒé…ç½®ã€‚</p>

<p>(1)æœ€æ–°çš„CentOS 7å·²å…¨é¢æ”¯æŒPacemakerï¼Œå¯ä»¥é€šè¿‡yumè¿›è¡Œå®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹å¦‚ã€ç¤º ä¾‹9-1ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-1ã€‘</p>

<p>#ä¸ä¹‹å‰çš„LVSé…ç½®ç›¸åŒï¼Œå…ˆè¦å¯¹é˜²ç«å¢™å’ŒSELinuxè¿›è¡Œé…ç½®</p>

<p>#åœ¨æœ¬ä¾‹ä¸­å°†å…³é—­é˜²ç«å¢™å’ŒSELinux</p>

<p>#ä»¥ä¸‹å‘½ä»¤ç”¨äºç¦ç”¨å’Œå…³é—­é˜²ç«å¢™</p>

<p>[root@localhost # systemctl disable firewalld</p>

<p>[root@localhost ã€œ]# systemctl stop firewalld</p>

<p>#ä»¥ä¸‹å‘½ä»¤ç”¨äºå…³é—­SELinmcï¼Œä½†é‡å¯åå¤±æ•ˆ</p>

<p>[root@localhost    å¼ setenforce 0</p>

<p>#é‡å¯åç”Ÿæ•ˆï¼Œå¯ä»¥ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ä¸­çš„è¯­å¥</p>

<p>#ä¿®æ”¹ä¸ºdisabledé‡å¯å³å¯</p>

<p>[root@localhost ~]# cat /etc/sysconfig/selinux</p>

<p>SELINUX^disabled</p>

<p>å¹¶åˆ©ç”¨yumå·¥å…·å®‰è£…Pacemaker</p>

<p>[root@localhost ã€œH yum install -y fence-agents-all corosync pacemaker pcs Loaded plugins: fastestmirror, langpacks Loading mirror speeds from cached hostfile</p>

<p>*    base: mirrors.sina.cn</p>

<p>*    extras: mirrors.btte.net</p>

<p>*    updates: mirrors.sina.cn</p>

<p>ç»è¿‡ä»¥ä¸Šæ­¥éª¤å®ŒæˆPacemakerè½¯ä»¶çš„å®‰è£…ï¼Œä¸»è¦çš„è½¯ä»¶åŒ…åŠä½œç”¨å¦‚è¡¨9.2æ‰€ç¤ºã€‚</p>

<p>è¡¨9.2 Pacemakerè½¯ä»¶åŒ…è¯´æ˜</p>

<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>

<tbody>
<tr>
<td>fence-agents-all</td>
<td>fenceè®¾å¤‡ä»£ç†</td>
</tr>

<tr>
<td>pacemaker</td>
<td>é›†ç¾¤èµ„æºç®¡ç†å™¨</td>
</tr>

<tr>
<td>corosync</td>
<td>é›†ç¾¤å¼•æ“å’Œåº”ç”¨ç¨‹åºæ¥å£</td>
</tr>

<tr>
<td>pcs</td>
<td>Pacemakeré…ç½®å·¥å…·</td>
</tr>
</tbody>
</table>

<p>(2)ä¸¤ä¸ªèŠ‚ç‚¹é…ç½®ä¸»æœºåå’Œ/etc/hosts</p>

<p>é…ç½®é›†ç¾¤æ—¶ï¼Œé€šå¸¸éƒ½ä¼šä½¿ç”¨ä¸»æœºåæ¥æ ‡è¯†é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹hostnameoå¦‚æœ ä½¿ç”¨DNSè§£æé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼Œè§£æå»¶æ—¶ä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤å“åº”ç¼“æ…¢ï¼Œå› æ­¤ä»»ä½•é›†ç¾¤éƒ½å»ºè®®ä½¿ç”¨ hostsæ–‡ä»¶è§£æè€Œä¸æ˜¯DNSï¼Œå¦‚ã€ç¤ºä¾‹9-2ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-2ã€‘</p>

<p>#æ­¤å¤„åœ¨nodelå³192.168.3.87ä¸Šåšçš„é…ç½®ï¼Œ192.168.3.88ä¸Šåˆ™ä¿®æ”¹node2</p>

<p>[root@localhost ~]# cat /etc/hostname</p>

<p>nodel</p>

<p>#ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„/etc/hostsæ–‡ä»¶å†…å®¹ç›¸åŒ</p>

<p>[root@localhost # cat /etc/hosts</p>

<dl>
<dt>127.0.0.1 localhost localhost.localdomain localhost4 localhost4.Iocaldomain4</dt>
</dl>

<p>::1    localhost localhost. localdomain localhost6 localhost6. localdomain6</p>

<p>192.168.3.87 nodel</p>

<p>192.168.3.88 node2</p>

<p>#ä¿®æ”¹å®Œæˆååˆ†åˆ«é‡å¯ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„networkæœåŠ¡</p>

<p>[root@localhost ã€œsystemctl restart network.service</p>

<p>ç½‘ç»œæœåŠ¡é‡å¯åï¼Œå¯ä»¥é€šè¿‡é‡æ–°ç™»å½•çš„æ–¹å¼æŸ¥çœ‹å‘½ä»¤æç¤ºç¬¦çš„å˜åŒ–ã€‚</p>

<p>(3)é…ç½®sshå¯†åŒ™è®¿é—®</p>

<p>é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡sshè¿›è¡Œçš„ï¼Œä½†sshè®¿é—®éœ€è¦å¯†ç ï¼Œå› æ­¤éœ€è¦é…ç½®å¯†åŒ™è®¿é—®ï¼Œ å¦‚ã€ç¤ºä¾‹9-3ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-3]</p>

<p>#ç”Ÿæˆå¯†åŒ™</p>

<p>[root@nodel -]# ssh-keygen -t rsa -P 1&rsquo;</p>

<p>Generating public/private rsa key pair.</p>

<p>Enter file in which to save the key (/root/.ssh/id ä¸€rsa): Created directory */root/.ssh1.</p>

<p>Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is:</p>

<p>cb:80:4c:bf:48:62:9e:fb:88:fa:27:93:a6:2d:c5:92 root@nodel The key * s randomart image is:</p>

<p>+&ndash;[ RSA 2048]&mdash;-+</p>

<p>loo    I</p>

<p>I oo + o S IEoo+ . + .</p>

<p>I oo.. . o</p>

<p><img src="11 CentOS7fbdfa1060ed0f49e18-187.jpg" alt="img" /></p>

<p>I.0=0.</p>

<p>ï¼›j;&lsquo;a=KES=&gt;6=.</p>

<p>#ä»¥ä¸Šå‘½ä»¤å°†ç”Ÿæˆä¸€å¯¹å…¬åŒ™å’Œç§åŒ™ #ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†å…¬åŒ™å‘é€ç»™node2</p>

<p>[root@nodel -3 # ssh-copy-id -i /root/.ssh/id_rsa.pub root@node2 The authenticity of host * node2 (172.16.45.13)1 can&rsquo;t be established.</p>

<p>ECDSA key fingerprint is 89:d7:26:24:04:le:a9:a5:47ï¼š3e:ef:b9:ce:a5:84:be. Are you sure you want to continue connecting (yes/no)? yes</p>

<p>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s)z to filter out any that are already installed</p>

<p>/usr/bin/ssh-copy~id: INFO: 1 key (s) remain to be installed &ndash; if you are prompted now it is to install the new keys</p>

<p>#æ­¤å¤„éœ€è¦è¾“å…¥node2çš„rootå¯†ç  root@node21s password:</p>

<p>Number of key(s) added: 1</p>

<p>Now try logging into the machine, with:    &ldquo;ssh 1 root@node2 &ldquo;ï¼Œ</p>

<p>and check to make sure that only the key(s) you wanted were added.</p>

<p>æ¥ä¸‹æ¥åœ¨node2ä¸Šé‡å¤ä¸Šè¿°æ“ä½œï¼Œè®©nodelå’Œnode2ä¹‹é—´å‡å¯ä»¥ä½¿ç”¨å¯†åŒ™è®¿é—®ã€‚</p>

<p>(4)é…ç½®é›†ç¾¤ç”¨æˆ·</p>

<p>Pacemakerä½¿ç”¨çš„ç”¨æˆ·åä¸ºhaclusterï¼Œè½¯ä»¶å®‰è£…æ—¶æ­¤ç”¨æˆ·å·²åˆ›å»ºï¼Œä½†è¿˜æ²¡æœ‰è®¾ç½®å¯†ç ï¼Œæ­¤ æ—¶éœ€è¦è®¾ç½®å…¶å¯†ç ï¼Œå¦‚ã€ç¤ºä¾‹9-4ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-4]</p>

<p>#ä¿®æ”¹ç”¨æˆ·haclusterçš„å¯†ç </p>

<p>[root@nodel ~]# passwd hacluster</p>

<p>Changing password for user hacluster.</p>

<p>New password:</p>

<p>Retype new password:</p>

<p>passwd: all authentication tokens updated successfully.</p>

<p>åœ¨nodelä¸Šä¿®æ”¹haclusterçš„å¯†ç¢ä¹‹åï¼Œè¿˜è¦ä¿®æ”¹node2ä¸Šçš„haclusterç”¨æˆ·å¯†ç ï¼Œæ­¤å¤„éœ€ è¦æ³¨æ„çš„æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„haclusterå¯†ç åº”è¯¥ç›¸åŒã€‚</p>

<p>(5)é…ç½®é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„è®¤è¯</p>

<p>æ¥ä¸‹æ¥åº”è¯¥å¯åŠ¨pcsdæœåŠ¡ï¼Œå¹¶é…ç½®å„èŠ‚ç‚¹ä¹‹é—´çš„è®¤è¯ï¼Œè®©èŠ‚ç‚¹ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ï¼Œå¦‚ã€ç¤º ä¾‹9-5ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-5ã€‘</p>

<p>#å¯åŠ¨pcSdæœåŠ¡å¹¶è®¾ç½®è‡ªå¯åŠ¨</p>

<p>#éœ€è¦åœ¨ä¸¤ä¸ªèŠ‚é‚Šä¸Šéƒ½å¼€è«–pes dæœåŠ¡</p>

<p>[root@nodel -]# systemctl start pcsd.service [rootQnodel # systemctl enable pcsd.service In -s */usr/lib/systemd/system/pcsd.service1 /etc/systemd/system/multi-user.target.wants/pcsd.service #é…ç½®èŠ‚ç‚¹é—´çš„è®¤è¯</p>

<p>#ä»¥ä¸‹å‘½ä»¤ä»…éœ€è¦åœ¨nodelä¸Šæ‰§è¡Œå³å¯</p>

<p>[root@nodel # pcs cluster auth nodel node2</p>

<p>#éœ€è¦è¾“å…¥ç”¨æˆ·åhaclusteråŠå¯†ç </p>

<p>Username: hacluster</p>

<p>Password:</p>

<p>nodel: Authorized</p>

<p>node2: Authorized</p>

<p>é…ç½®å®ŒèŠ‚ç‚¹é—´è®¤è¯åç¯å¢ƒé…ç½®å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ–°å»ºé›†ç¾¤å¹¶å‘é›†ç¾¤ä¸­æ·»åŠ èµ„æºäº†ã€‚</p>

<p>9.2.3 Pacemaker èµ„æºé…ç½®</p>

<p>Pacemakerå¯ä»¥ä¸ºå¤šç§æœåŠ¡æä¾›æ”¯æŒï¼Œä¾‹å¦‚Apacheã€MySQLã€Xenç­‰ï¼Œå¯ä½¿ç”¨çš„èµ„æºç±» å‹æœ‰IPåœ°å€ã€æ–‡ä»¶ç³»ç»Ÿã€æœåŠ¡ã€fenceè®¾å¤‡ç­‰ï¼Œæœ¬å°èŠ‚å°†ä»¥æœ€ç®€å•çš„Apacheä¸ºä¾‹ä»‹ç»å¦‚ä½•æ·» åŠ é›†ç¾¤å’Œèµ„æºã€‚</p>

<p><img src="11 CentOS7fbdfa1060ed0f49e18-188.jpg" alt="img" /></p>

<p>fenceè®¾å¤‡å›½å†…é€šå¸¸ç§°ä¸ºè¿œç¨‹æ§åˆ¶å¡ï¼Œåœ¨èŠ‚ç‚¹å¤±æ•ˆåé›†ç¾¤å¯ä»¥é€šè¿‡fenceè®¾å¤‡å°†å¤±æ•ˆèŠ‚ ç‚¹æœåŠ¡å™¨é‡å¯ã€‚ä¸åŒå‚å•†çš„fenceè®¾å¤‡ä½¿ç”¨æ–¹æ³•ä¹Ÿä¸åŒï¼Œä½¿ç”¨ä¹‹å‰éœ€è¦é˜…è¯»ç›¸å…³çš„ç¡¬ ä»¶æ–‡æ¡£äº†è§£ã€‚</p>

<p>(1)é…ç½® Apache</p>

<p>åœ¨èŠ‚ç‚¹nodelå’Œnode2ä¸Šé…ç½®Apacheï¼Œå¦‚ã€ç¤ºä¾‹9-6ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-6ã€‘</p>

<p># å®‰è£… Apache</p>

<p>[rootgnodel # yum install -y httpd #åœ¨é…ç½®æ–‡ä»¶Apacheæœ€ååŠ å…¥ä»¥ä¸‹å†…å®¹</p>

<p>[root@nodel -J# tail /etc/httpd/conf/httpd.conf #é…ç½®ç›‘å¬åœ°å€å’ŒæœåŠ¡å™¨å Listen 0.0.0.0:80 ServerName <a href="http://www.test.com">www.test.com</a></p>

<p>#è®¾ç½®æœåŠ¡å™¨çŠ¶æ€é¡µé¢ä»¥ä¾¿é›†ç¾¤æ£€æµ‹ ã€ˆLocation /server-status&gt;</p>

<p>SetHandler server-status Require all granted ã€ˆ/Locationã€‰</p>

<p>#è®¾ç½®ä¸€ä¸ªæœ€ç®€å•çš„é¡µé¢ç¤ºä¾‹å¹¶æµ‹è¯•</p>

<p>[root@nodel ã€œ]æ¯‹ echo &ldquo;welcome to nodeln &gt;/var/www/html/index.html</p>

<p>[rootgnodel -]# systemctl start httpd.service [rootenodel -]# curl http: &ldquo;192 .è‚Œ3.87</p>

<p>welcome to nodel    ,</p>

<p>Pacemakerå¯ä»¥æ§åˆ¶httpdæœåŠ¡çš„å¯åŠ¨å’Œå…³é—­ï¼Œå› æ­¤åœ¨node 1å’Œnode2ä¸Šé…ç½®å®ŒApacheå¹¶ æµ‹è¯•ä¹‹åè¦å…³é—­httpdæœåŠ¡ã€‚</p>

<p>(2)æ–°å»ºå¹¶å¯åŠ¨é›†ç¾¤</p>

<p>å®Œæˆä»¥ä¸Šå‡†å¤‡å·¥ä½œåï¼Œå°±å¯ä»¥åœ¨èŠ‚ç‚¹nodelä¸Šæ–°å»ºä¸€ä¸ªé›†ç¾¤å¹¶å¯åŠ¨ï¼Œå¦‚ã€ç¤ºä¾‹9-7ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-7ã€‘</p>

<p>#æ–°å»ºä¸€ä¸ªåä¸ºmy clusterçš„é›†ç¾¤</p>

<p>#é›†ç¾¤èŠ‚ç‚¹åŒ…æ‹¬nodelå’Œnode2</p>

<p>[root@nodel # pcs cluster setup &ndash;name mycluster nodel node2 Shutting down pacemaker/corosync services&hellip;</p>

<p>Redirecting to /bin/systemctl stop pacemaker.service Redirecting to /bin/systemctl stop corosync.service Killing any remaining services&hellip;</p>

<p>Removing all cluster configuration files&hellip;</p>

<p>nodel: Succeeded</p>

<p>node2: Succeeded</p>

<p>#å¯åŠ¨é›†ç¾¤å¹¶è®¾ç½®é›†ç¾¤è‡ªå¯åŠ¨</p>

<p>[root@nodel # pcs cluster start &ndash;all</p>

<p>node2: Starting Cluster&hellip;</p>

<p>nodel: Starting Cluster&hellip;</p>

<p>[root@nodel # pcs cluster enable ä¸€ä¸€all</p>

<p>nodel: Cluster Enabled</p>

<p>node2: Cluster Enabled</p>

<p>#æŸ»çœ‹é›†ç¾¤çŠ¶æ€</p>

<p>[root@nodel # pcs status</p>

<p>Cluster name: mycluster</p>

<p>WARNING: no stonith devices and stonith-enabled is not false Last updated: Sat Apr 25 18:43:29 2015 Last change: Sat Apr 25 18:41:40 2015 Stack: corosync</p>

<p>Current DC: nodel â‘´-partition with quorum</p>

<p>Version: 1.1.12-al4efad</p>

<p>2 Nodes configured</p>

<p>0 Resources configured</p>

<p>Online: [ nodel node2 }</p>

<p>Full list of resources:</p>

<p>PCSD Status: nodel: Online node2: Online</p>

<p>Daemon Status:</p>

<p>corosync: active/enabled pacemaker: active/enabled pcsd: active/enabled</p>

<p><img src="11 CentOS7fbdfa1060ed0f49e18-189.jpg" alt="img" /></p>

<p>ä»ä¸Šè¿°å‘½ä»¤å¯ä»¥çœ‹åˆ°åœ¨nodelä¸Šæ–°å»ºé›†ç¾¤ä¹‹åï¼Œæ‰€æœ‰çš„è®¾ç½®éƒ½ä¼šåŒæ­¥åˆ°node2ä¸Šï¼Œè€Œåœ¨é›† ç¾¤çŠ¶æ€ä¸­å¯ä»¥çœ‹åˆ°nodelå’Œnode2å‡å·±åœ¨çº¿ï¼Œé›†ç¾¤ä½¿ç”¨çš„æœåŠ¡éƒ½å·²æ¿€æ´»å¹¶å¯åŠ¨ã€‚</p>

<p>(3)ä¸ºé›†ç¾¤æ·»åŠ èµ„æº</p>

<p>ä»ç¬¬(2)æ­¥é›†ç¾¤çŠ¶æ€ä¸­çš„&rdquo;Full list of resources&rdquo;ä¸­å¯ä»¥çœ‹åˆ°é›†ç¾¤è¿˜æ²¡æœ‰ä»»ä½•èµ„æºï¼Œæ¥ä¸‹ æ¥å°†ä¸ºé›†ç¾¤æ·»åŠ VIPå’ŒæœåŠ¡ï¼Œå¦‚ã€ç¤ºä¾‹9-8ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-8ã€‘</p>

<p>#æ·»åŠ ä¸€ä¸ªåä¸ºvipçš„IPåœ°å€èµ„æº #ä½¿ç”¨heartbeatä½œä¸ºå¿ƒè·³æ£€æµ‹ #é›†ç¾¤æ¯éš”30sæ£€æŸ»è¯¥èµ„æºä¸€æ¬¡</p>

<p>[root@nodel # pcs resource create VIP ocfğŸ’“ IPaddr2 ip=192.168.3.118 cidr_netmask-24 op monitor interval=30s</p>

<p>#æ·»åŠ ä¸€ä¸ªåä¸ºWebçš„Apacheèµ„æº</p>

<p>#æ£€æŸ¥è¯¥èµ„æºé€šè¿‡è®¿é—®http: //127.0.0.1/server-statusæ¥å®ç° (root@nodel # pcs resource create Web ocfğŸ’“apache</p>

<p>configfile=/etc/httpd/conf/httpd.conf</p>

<p>statusurl=n<a href="http://127.0.0.1/server-status">http://127.0.0.1/server-status</a>&rdquo; op monitor interval=30s [root@nodel ~]# pcs status Cluster name: mycluster</p>

<p>WARNING: no stonith devices and stonithâ€”enabled is not false</p>

<p>Online: [ nodel node2 ]</p>

<p>#ä»¥ä¸‹ä¸ºèµ„æºæ± æƒ…å†µ</p>

<p>Full list of resources:</p>

<p>VIP (ocf:ğŸ’“IPaddr2):    Stopped</p>

<p>Web (ocf:ğŸ’“apache):    Stopped</p>

<p>PCSD Status: nodel: Online node2: Online</p>

<p>(4)è°ƒæ•´èµ„æº</p>

<p>æ·»åŠ èµ„æºåè¿˜éœ€è¦å¯¹èµ„æºè¿›è¡Œè°ƒæ•´ï¼Œè®©VIPå’ŒWebè¿™ä¸¤ä¸ªèµ„æºâ€œæ†ç»‘â€åœ¨ä¸€èµ·ï¼Œä»¥å…å‡º ç°VIPåœ¨èŠ‚ç‚¹nodelä¸Šï¼Œè€ŒApagheè¿è¡Œåœ¨node2ä¸Šçš„æƒ…å†µã€‚å¦ä¸€ä¸ªæƒ…å†µåˆ™æ˜¯æœ‰å¯èƒ½é›†ç¾¤å…ˆå¯ åŠ¨Apache,ç„¶åå†å¯ç”¨VIP,è¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚è°ƒæ•´å¦‚ã€ç¤ºä¾‹9-9ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-9]</p>

<p>#æ–¹å¼ä¸€ï¼šä½¿ç”¨ç»„çš„æ–¹å¼â€œæ†ç»‘â€èµ„æº</p>

<p>#å°†VIPå’ŒWebæ·»åŠ åˆ°mywebç»„ä¸­</p>

<p>[root@nodel # pcs resource group add myweb VIP</p>

<p>[root@nodel ã€œ]# pcs resource group add myweb Web</p>

<p>#æ–¹å¼äºŒï¼šä½¿ç”¨æ‰˜ç®¡çº¦æŸ</p>

<p>[root@nodel # pcs constraint colocation add Web VIP INFINITY #è®¾ç½®èµ„æºçš„å¯åŠ¨åœæ­¢é¡ºåº #å…ˆå¯åŠ¨VIP,ç„¶åå†å¯åŠ¨Web</p>

<p>[root@nodel # pcs constraint order start VIP then start Web</p>

<p>(5)ä¼˜å…ˆçº§</p>

<p>å¦‚æœnodelä¸node2çš„ç¡¬ä»¶é…ç½®ä¸åŒï¼Œé‚£ä¹ˆåº”è¯¥è°ƒæ•´èŠ‚ç‚¹çš„ä¼˜å…ˆçº§ï¼Œè®©èµ„æºè¿è¡Œäºç¡¬ä»¶é… ç½®è¾ƒå¥½çš„æœåŠ¡å™¨ä¸Šï¼Œå¾…å…¶å¤±æ•ˆåå†è½¬ç§»è‡³è¾ƒä½é…ç½®çš„æœåŠ¡å™¨ä¸Šã€‚è¿™å°±éœ€è¦é…ç½®ä¼˜å…ˆçº§ (Pacemakerä¸­ç§°ä¸ºLocation),æ­¤é…ç½®ä¸ºå¯é€‰ï¼Œå¦‚ã€ç¤ºä¾‹9-10ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-10ã€‘</p>

<p>#è°ƒæ•´ Location</p>

<p>#æ•°å€¼è¶Šå¤§è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜</p>

<p>[root@nodel # pcs constraint location Web prefers nodel=10 [rootQnodel H# pcs constraint location Web prefers node2=5 (root@nodel ã€œcrm ä¸€simulate ~sL</p>

<p>Current cluster status:</p>

<p>Online: ( nodel node2 J</p>

<p>Resource Group: myweb</p>

<p>VIP    (ocf:ğŸ’“IPaddr2)</p>

<p>Started nodel Started nodel</p>

<p>Web    (ocf:ğŸ’“apache):</p>

<table>
<thead>
<tr>
<th>scores</th>
<th>;:</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>

<tbody>
<tr>
<td>â€¢: VIP</td>
<td>allocation</td>
<td>score</td>
<td>on</td>
<td>nodel:</td>
<td>G</td>
</tr>

<tr>
<td>:VIP</td>
<td>allocation</td>
<td>score</td>
<td>on</td>
<td>node2:</td>
<td>0</td>
</tr>

<tr>
<td>:Web</td>
<td>allocation</td>
<td>score</td>
<td>on</td>
<td>nodel:</td>
<td>20</td>
</tr>

<tr>
<td>:Web</td>
<td>allocation</td>
<td>score</td>
<td>on</td>
<td>node2:</td>
<td>10</td>
</tr>
</tbody>
</table>

<p>gro å©ä¸€ color group_color groupä¸€color group_color</p>

<p>40</p>

<p>native color: VIP allocation score on nodel</p>

<p>ä¸€</p>

<p>nativeä¸€color: VIP allocation score on node2: 20 native color: Web allocation score on nodel: 20</p>

<p>native_color: Web allocation score on node2: -INFINITY</p>

<p>åœ¨æœ¬ä¾‹ä¸­å¹¶æ²¡æœ‰è®¾ç½®fenceè®¾å¤‡ï¼Œé›†ç¾¤åœ¨å¯åŠ¨æ—¶å¯èƒ½ä¼šæç¤ºä¸€äº›é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤pcs property set stonith-enabled=falseç¦ç”¨fenceè®¾å¤‡ã€‚è¯»è€…ä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨Linuxä¸Šçš„è™šæ‹Ÿæœºä¸­ ä½¿ç”¨è™šæ‹Ÿfenceè®¾å¤‡ï¼Œå…³äºè™šæ‹Ÿfenceè®¾å¤‡çš„ä½¿ç”¨æ–¹æ³•å¯å‚è€ƒç›¸å…³æ–‡æ¡£äº†è§£ã€‚</p>

<p>9.2.4 Pacemaker æµ‹è¯•</p>

<p>ç»è¿‡ä¸Šé¢çš„é…ç½®ï¼ŒPacemakeré›†ç¾¤å·²ç»é…ç½®å®Œæˆï¼Œé‡æ–°å¯åŠ¨é›†ç¾¤æ‰€æœ‰è®¾ç½®å¯ä»¥ç”Ÿæ•ˆï¼Œå¯åŠ¨ è¿‡ç¨‹å¦‚ã€ç¤ºä¾‹9-11ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-11 ]</p>

<p>åˆ©äº­æ­¢æ‰€æœ‰é›†ç¾¤</p>

<p>[root@nodel ~]# pcs cluster 1 stop â€”-all nodel: Stopping Cluster (pacemaker)&hellip;</p>

<p>node2: Stopping</p>

<p>node2: Stopping nodel: Stopping</p>

<p>#å¯åŠ¨æ‰€æœ‰é›†ç¾¤</p>

<p>Cluster (pacemaker).,. Cluster (corosync)&hellip; Cluster (corosync)&hellip;</p>

<p>[root@nodel -]# pcs cluster start &ndash;all nodel: Starting Cluster&hellip;</p>

<p>node2: Starting Cluster&hellip;</p>

<p>#æŸ»çœ‹é›†ç¾¤çŠ¶æ€</p>

<p>[root@nodel ã€œ]# pcs status</p>

<p>Cluster name: mycluster</p>

<p>Last updated: Sat Apr 25 23:13:26 2015 Last change: Sat Apr 25 23:04:27 2015 Stack: corosync</p>

<p>Current DC: node2 (2) - partition with quorum Version : 1.1.1.2-al4efad 2 Nodes configured 2 Resources configured</p>

<p>Started nodel Started nodel</p>

<p><img src="11 CentOS7fbdfa1060ed0f49e18-190.jpg" alt="img" /></p>

<p>Full list of resources:</p>

<p>Resource Group: myweb</p>

<p>VIP    (ocf:ğŸ’“IPaddr2)</p>

<p>Web    (ocf:ğŸ’“apache):</p>

<p>PCSD Status: nodel: Online node2: Online</p>

<p>#éªŒè¯VIPæ˜¯å¦å¯ç”¨</p>

<p>[rootGnodel # ip address show 1: lo: <LOOPBACKrUP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN</p>

<p>*â™¦â€¢åƒâ– é²</p>

<p>2: enol6777736: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifoä¸€fast state UP qlen 1000</p>

<p>link/ether 00:0c:29:a0:3e:e5 brd</p>

<p>inet 192.168.3.<sup>87</sup>&frasl;<sub>24</sub> brd 192.168.3.255 scope global dynamic eno!6777736</p>

<p>valid_lft 25521sec preferred_lft inet 192.168.3.<sup>118</sup>&frasl;<sub>24</sub> brd 192.168.3.</p>

<p>#éªŒè¯Apacheæ˜¯å¦å¯åŠ¨</p>

<p>[rootQnodel # ps aux | grep httpd root 51300    0.0    1.2 237896    6196 ?</p>

<p>-DSTATUS -f /etc/httpd/conf/httpd.conf -c</p>

<p>[root@nodel ~]# curl <a href="http://192.168.3">http://192.168.3</a>. welcome to nodel</p>

<p>25521sec</p>

<p>255 scope global secondary enol6777736</p>

<p>Ss 23:13    0:00 /sbin/httpd</p>

<p>PidFile /var/run//httpd.pid</p>

<p>. â–  â–  â–  , â– </p>

<p>118</p>

<p>å¯åŠ¨åæ­£å¸¸æƒ…å†µä¸‹VIPè®¾ç½®åœ¨ä¸»èŠ‚ç‚¹192.168.3.87ä¸Šã€‚å¦‚ä¸»èŠ‚ç‚¹æ•…éšœï¼Œåˆ™èŠ‚ç‚¹node2è‡ªåŠ¨ æ¥ç®¡æœåŠ¡ï¼Œæ–¹æ³•æ˜¯ç›´æ¥é‡å¯èŠ‚ç‚¹nodelï¼Œç„¶åè§‚å¯Ÿå¤‡èŠ‚ç‚¹æ˜¯å¦æ¥ç®¡äº†ä¸»æœºçš„èµ„æºï¼Œæµ‹è¯•è¿‡ç¨‹å¦‚ ã€ç¤ºä¾‹9-12ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-12ã€‘</p>

<p>#åœ¨èŠ‚ç‚¹nodelä¸Šæ‰§è¡Œé‡å¯æ“ä½œ [root@nodel # reboot [root@node2 ~]# pcs status</p>

<p>Cluster name: mycluster</p>

<p>Last updated: Sat Apr 25 23:23:41 2015</p>

<p>Online: [ node2 ] OFFLINE: [ nodel ]</p>

<p>Full list of resources:</p>

<p>Resource Group: myweb</p>

<p>VIP    (ocf:ğŸ’“IPaddr2)</p>

<p>Web    (ocf:ğŸ’“apache):</p>

<p>PCSD Status: nodel: Offline node2: Online</p>

<p>Daemon Status:</p>

<p>corosync: active/enabled pacemaker: active/enabled</p>

<p><img src="11 CentOS7fbdfa1060ed0f49e18-191.jpg" alt="img" /></p>

<p><img src="11 CentOS7fbdfa1060ed0f49e18-192.jpg" alt="img" /></p>

<p>Started node2 Started node2</p>

<p><img src="11 CentOS7fbdfa1060ed0f49e18-193.jpg" alt="img" /></p>

<p><img src="11 CentOS7fbdfa1060ed0f49e18-194.jpg" alt="img" /></p>

<p>pcsd: active/enabled</p>

<p>å½“èŠ‚ç‚¹nodelæ•…éšœæ—¶ï¼ŒèŠ‚ç‚¹node2æ”¶ä¸åˆ°å¿ƒè·³è¯·æ±‚ï¼Œè¶…è¿‡è®¾ç½®çš„æ—¶é—´åèŠ‚ç‚¹node2å¯ç”¨èµ„ æºæ¥ç®¡ç¨‹åºï¼Œä¸Šè¿°å‘½ä»¤è¾“å‡ºä¸­è¯´æ˜VIPå’ŒWebå·²ç»è¢«èŠ‚ç‚¹node2æˆåŠŸæ¥ç®¡ã€‚å¦‚æœèŠ‚ç‚¹nodel æ¢å¤ä¸”è®¾ç½®äº†ä¼˜å…ˆç»™ï¼ŒVIPå’ŒWebåˆä¼šé‡æ–°è¢«èŠ‚ç‚¹nodelæ¥ç®¡ã€‚</p>

<p>1.3    åŒæœºçƒ­å¤‡è½¯ä»¶keepalived</p>

<p>å…³äºHAç›®å‰æœ‰å¤šç§è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚Heartbeatã€keepalivedç­‰ï¼Œå„æœ‰ä¼˜ç¼ºç‚¹ã€‚æœ¬èŠ‚ä¸»è¦ä»¥ keepalivedä¸ºä¾‹è¯´æ˜keepalivedçš„ä½¿ç”¨æ–¹æ³•ã€‚</p>

<p>9.3.1 keepalived æ¦‚è¿°</p>

<p>keepalivedçš„ä½œç”¨æ˜¯æ£€æµ‹åç«¯TCPæœåŠ¡çš„çŠ¶æ€ï¼Œå¦‚æœæœ‰ä¸€å°æä¾›TCPæœåŠ¡çš„åç«¯èŠ‚ç‚¹æ­» æœºï¼Œæˆ–å·¥ä½œå‡ºç°æ•…éšœï¼ŒkeepalivedåŠæ—¶æ£€æµ‹åˆ°ï¼Œå¹¶å°†æœ‰æ•…éšœçš„èŠ‚ç‚¹ä»ç³»ç»Ÿä¸­å‰”é™¤ï¼Œå½“æä¾›TCP æœåŠ¡çš„èŠ‚ç‚¹æ¢å¤å¹¶ä¸”æ­£å¸¸æä¾›æœåŠ¡åkeepalivedè‡ªåŠ¨å°†æä¾›TCPæœåŠ¡çš„èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œ è¿™äº›å·¥ä½œå…¨éƒ¨ç”±keepalivedè‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦äººå·¥å¹²æ¶‰ï¼Œéœ€è¦äººå·¥åšçš„åªæ˜¯ä¿®å¤æ•…éšœçš„æœåŠ¡å™¨ã€‚</p>

<p>keepalivedå¯ä»¥å·¥ä½œåœ¨TCP/IPåè®®æ ˆçš„IPå±‚ã€TCPå±‚åŠåº”ç”¨å±‚ï¼š</p>

<p>(1) IP å±‚</p>

<p>keepalivedä½¿ç”¨IPçš„æ–¹å¼å·¥ä½œæ—¶ï¼Œä¼šå®šæœŸå‘æœåŠ¡å™¨ç¾¤ä¸­çš„æœåŠ¡å™¨å‘é€ä¸€ä¸ªICMPçš„æ•°æ®åŒ…ï¼Œ å¦‚æœå‘ç°æŸå°æœåŠ¡çš„IPåœ°å€æ²¡æœ‰æ¿€æ´»ï¼Œkeepalivedä¾¿æŠ¥å‘Šè¿™å°æœåŠ¡å™¨å¼‚å¸¸ï¼Œå¹¶å°†å…¶ä»é›†ç¾¤ä¸­å‰” é™¤ã€‚å¸¸è§çš„åœºæ™¯ä¸ºæŸå°æœºå™¨ç½‘å¡æŸåæˆ–æœåŠ¡å™¨è¢«éæ³•å…³æœºã€‚IPå±‚çš„å·¥ä½œæ–¹å¼æ˜¯ä»¥æœåŠ¡å™¨çš„IP åœ°å€æ˜¯å¦æœ‰æ•ˆä½œä¸ºæœåŠ¡å™¨å·¥ä½œæ­£å¸¸ä¸å¦çš„æ ‡å‡†ã€‚</p>

<p>(2) TCPå±‚</p>

<p>è¿™ç§å·¥ä½œæ¨¡å¼ä¸»è¦ä»¥TCPåå°æœåŠ¡çš„çŠ¶æ€æ¥ç¡®å®šåç«¯æœåŠ¡å™¨æ˜¯å¦å·¥ä½œæ­£å¸¸ã€‚å¦‚MySQL æœåŠ¡é»˜è®¤ç«¯å£ä¸€èˆ¬ä¸º3306,å¦‚æœkeepalivedæ£€æµ‹åˆ°3306æ— æ³•ç™»å½•æˆ–æ‹’ç»è¿æ¥ï¼Œåˆ™è®¤ä¸ºåç«¯æœ åŠ¡å¼‚å¸¸ï¼Œåˆ™keepalivedå°†æŠŠè¿™å°æœåŠ¡å™¨ä»é›†ç¾¤ä¸­å‰”é™¤ã€‚</p>

<p>(3)åº”ç”¨å±‚</p>

<p>å¦‚keepalivedå·¥ä½œåœ¨åº”ç”¨å±‚äº†ï¼Œæ­¤æ—¶keepalivedå°†æ ¹æ®ç”¨æˆ·çš„è®¾å®šæ£€æŸ¥æœåŠ¡å™¨ç¨‹åºçš„è¿è¡Œ æ˜¯å¦æ­£å¸¸ï¼Œå¦‚æœä¸ç”¨æˆ·çš„è®¾å®šä¸ç›¸ç¬¦ï¼Œåˆ™keepalivedå°†æŠŠæœåŠ¡å™¨ä»é›†ç¾¤ä¸­å‰”é™¤ã€‚</p>

<p>ä»¥ä¸Šå‡ ç§æ–¹å¼å¯ä»¥é€šè¿‡keepalivedçš„é…ç½®æ–‡ä»¶å®ç°ã€‚</p>

<p>9.3.2 keepalivedå®‰è£…ä¸é…ç½®</p>

<p>æœ¬èŠ‚å®ç°çš„åŠŸèƒ½ä¸ºè®¿é—®192.168.3.118çš„WebæœåŠ¡æ—¶ï¼Œè‡ªåŠ¨ä»£ç†åˆ°åç«¯çš„çœŸå®æœåŠ¡å™¨</p>

<p>192.168.3.1 å’Œ 192.168.3.2, keepalived ä¸»æœºä¸º 192.168.3.87,å¤‡æœºä¸º 192.168.3.88ã€‚</p>

<p>æœ€æ–°çš„ç‰ˆæœ¬å¯ä»¥åœ¨<a href="http://www.keepalived.orgè·å–ï¼Œæœ¬ç¤ºä¾‹é‡‡ç”¨çš„ç‰ˆæœ¬ä¸º1.2.16ï¼Œå®‰è£…è¿‡ç¨‹">http://www.keepalived.orgè·å–ï¼Œæœ¬ç¤ºä¾‹é‡‡ç”¨çš„ç‰ˆæœ¬ä¸º1.2.16ï¼Œå®‰è£…è¿‡ç¨‹</a> å¦‚ã€ç¤ºä¾‹9-13ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-13ã€‘</p>

<p>ã€œ]# tar xvf keepalived-1.2.16.tar.gz # cd keepalived-1.2.16</p>

<p>[root@nodel</p>

<p>[root@nodel</p>

<p>#å®‰è£…ä¾èµ–è½¯ä»¶ [root@nodel [root@nodel [rootGnodel [root@nodel [rootQnodel /etc/</p>

<p>keepalived-1</p>

<p>keepalived-1</p>

<p>keepalived-1</p>

<p>keepalived-1</p>

<p>keepalived-1</p>

<p>2.16]    # yum install ~y openssl openssl-devel</p>

<p>2.16]    # ./configure &ndash;prefix=/usr/local/keepalived</p>

<p>2.16]    # make</p>

<p>2.16]# make install</p>

<p>2.16]# In -s /usr/local/keepalived/etc/keepalived</p>

<p>ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œkeepalivedå·²ç»å®‰è£…å®Œæˆï¼Œå®‰è£…è·¯å¾„ä¸º/usr/local/keepalivedï¼Œå¤‡èŠ‚ç‚¹æ“ä½œ æ­¥éª¤åŒä¸»èŠ‚ç‚¹ã€‚æ¥ä¸‹æ¥è¿›è¡Œé…ç½®æ–‡ä»¶çš„è®¾ç½®ï¼Œå¦‚ã€ç¤ºä¾‹9-14ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-14ã€‘</p>

<table>
<thead>
<tr>
<th>#ä¸»èŠ‚ç‚¹é…ç½®æ–‡ä»¶</th>
<th></th>
</tr>
</thead>

<tbody>
<tr>
<td>[root@nodel ã€œcat -n /etc/keepalived/keepalived.conf</td>
<td></td>
</tr>

<tr>
<td>19</td>
<td>! Configuration File for keepalived</td>
</tr>

<tr>
<td>ä¹ˆ3</td>
<td>vrrpä¸€instance VI_1 {</td>
</tr>

<tr>
<td>4</td>
<td>#æŒ‡å®šè¯¥èŠ‚ç‚¹ä¸ºä¸»èŠ‚ç‚¹å¤‡ç”¨èŠ‚ç‚¹ä¸Šéœ€è®¾ç½®ä¸ºBACKUP</td>
</tr>

<tr>
<td>5</td>
<td>state MASTER</td>
</tr>

<tr>
<td>6</td>
<td>#ç»‘å®šè™šæ‹ŸIPçš„ç½‘ç»œæ¥å£</td>
</tr>

<tr>
<td>7</td>
<td>interface enol677736</td>
</tr>

<tr>
<td>8</td>
<td>#VRRPç»„åï¼Œä¸¤ä¸ªèŠ‚ç‚¹éœ€è®¾ç½®ä¸€æ ·ï¼Œä»¥æŒ‡æ˜å„ä¸ªèŠ‚ç‚¹å±äºåŒä¸€ VRRPç»„</td>
</tr>

<tr>
<td>9</td>
<td>virtualä¸€router_id 51</td>
</tr>

<tr>
<td>10</td>
<td>#ä¸»èŠ‚ç‚¹fä¼˜å…ˆçº§ï¼Œ~æ•°å€¼åœ¨1~254,æ³¨æ„ä»èŠ‚ç‚¹å¿…é¡»æ¯”ä¸»èŠ‚ç‚¹ä¼˜å…ˆçº§ä½</td>
</tr>

<tr>
<td>11</td>
<td>priority 50</td>
</tr>

<tr>
<td>12</td>
<td>##ç»„æ’­ä¿¡æ¯å‘é€é—´éš”ï¼Œä¸¤ä¸ªèŠ‚ç‚¹éœ€è®¾ç½®ä¸€æ ·</td>
</tr>

<tr>
<td>13</td>
<td>advert_int 1</td>
</tr>

<tr>
<td>14</td>
<td>##è®¾ç½®iè¯ä¿¡æ¯ï¼Œä¸¤ä¸ªèŠ‚ç‚¹éœ€ä¸€è‡´</td>
</tr>

<tr>
<td>15</td>
<td>authentication {</td>
</tr>

<tr>
<td>16</td>
<td>authä¸€type PASS</td>
</tr>

<tr>
<td>17</td>
<td>auth_pass 1234</td>
</tr>

<tr>
<td>18</td>
<td>}</td>
</tr>

<tr>
<td>19</td>
<td>#æŒ‡å®šè™šæ‹Ÿä¸¤ä¸ªèŠ‚ç‚¹éœ€è®¾ç½®ä¸€æ ·</td>
</tr>

<tr>
<td>20</td>
<td>virtual_ipaddress {</td>
</tr>

<tr>
<td>21</td>
<td>192.168.3.118</td>
</tr>

<tr>
<td>22</td>
<td>}</td>
</tr>

<tr>
<td>23</td>
<td>}</td>
</tr>

<tr>
<td>24</td>
<td>#è™šæ‹ŸIPæœåŠ¡</td>
</tr>
</tbody>
</table>

<p>25    virtualä¸€server 192.168,3.118 80 {</p>

<p>26    #è®¾Â£æ£€æŸ»å®é™…æœåŠ¡å™¨çš„é—´éš”</p>

<p>27    delay_loop 6</p>

<p>28    #æŒ‡å®šLVSç®—æ³•</p>

<p>29    lb-algo rr</p>

<p>30    #æŒ‡å®šLVSæ¨¡å¼</p>

<p>31    lb_kind nat</p>

<p>32</p>

<p>33    nat_mask 255.255.255.255</p>

<p>34    #æŒåè¿æ¥è®¾ç½®ï¼Œä¼šè¯ä¿æŒæ—¶é—´</p>

<p>&lsquo;35    persistenceä¸€timeout 50</p>

<p>36    #è½¬å‘åè®®ä¸ºTCP</p>

<p>37    protocol TCP</p>

<p>38    #åç«¯å®é™…TCPæœåŠ¡é…ç½®</p>

<p>39    real_server 192.168.3.1 80 {</p>

<p>40    weight 1</p>

<p>å¤‡èŠ‚ç‚¹é…ç½®å¤§éƒ¨åˆ†é…ç½®åŒä¸»èŠ‚ç‚¹ï¼Œä¸åŒå¤„å¦‚ã€ç¤ºä¾‹9-15ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-15ã€‘</p>

<p>[root@node2 # cat -n /etc/keepalived/keepalived.conf #ä¸è¯äºä¸»èŠ‚ç‚¹ï¼Œå¤‡æœºstateè®¾ç½®ä¸ºBACKUP 4    state BACKUP</p>

<p>#ä¼˜å…ˆçº§ä½äºä¸»èŠ‚ç‚¹ 7    priority 50</p>

<p>#å…¶ä»–é…ç½®å’Œä¸»èŠ‚ç‚¹ç›¸åŒ</p>

<p>/etc/keepalived/keepalived.confä¸ºkeepalivedçš„ä¸»é…ç½®æ–‡ä»¶ã€‚ä»¥ä¸Šé…ç½®stateè¡¨ä¸ä¸»èŠ‚ç‚¹ä¸º 192.168.3.87,å¤‡èŠ‚ç‚¹ä¸º 192.168.3.88ã€‚è™šæ‹Ÿ IP ä¸º 192.168.3.11S åç«¯çš„çœŸå®æœåŠ¡å™¨æœ‰ 192.168.3.1 å’Œ192.168.3.2,å½“é€šè¿‡192.168.3.118è®¿é—®WebæœåŠ¡æ—¶ï¼Œè‡ªåŠ¨è½¬åˆ°åç«¯çš„çœŸå®èŠ‚ç‚¹ï¼Œåç«¯èŠ‚ç‚¹ çš„æƒé‡ç›¸åŒï¼Œç±»ä¼¼è½®è¯¢çš„æ¨¡å¼ã€‚ApacheæœåŠ¡çš„éƒ¨ç½²å¯å‚è€ƒå…¶ä»–ç« èŠ‚ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚</p>

<p>9.3.3 keepalivedå¯åŠ¨ä¸æµ‹è¯•</p>

<p>ç»è¿‡ä¸Šé¢çš„æ­¥éª¤keepalivedå·²ç»éƒ¨ç½²å®Œæˆï¼Œæ¥ä¸‹æ¥è¿›è¡Œkeepalivedçš„å¯åŠ¨ä¸æ•…éšœæ¨¡æ‹Ÿæµ‹è¯•ã€‚</p>

<p>1.å¯åŠ¨ keepalived</p>

<p>å®‰è£…å®Œæ¯•åkeepalivedå¯ä»¥è®¾ç½®ä¸ºç³»ç»ŸæœåŠ¡å¯åŠ¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨ï¼Œå‘½ä»¤è¡Œå¯</p>

<p>åŠ¨æ–¹å¼å¦‚ã€ç¤ºä¾‹9-16ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-16ã€‘</p>

<p>#ä¸»èŠ‚ç‚¹å¯åŠ¨keepalived</p>

<p>froot@nodel # export PATH~/usr/local/kGepalived/sbin:$PATH:.</p>

<p>[root@nodel -*] # keepalived -D -f /etc/keepalived/keepalived.conf #æŸ»çœ‹æœåŠ¡çŠ¶æ€</p>

<p>[root@nodel # ip addr list</p>

<p>inet 192.168.3.<sup>87</sup>&frasl;<sub>24</sub> brd 172.16.45.255 scope global dynamic enol6777736 validä¸€1ft 40807sec preferredä¸€Ift 40807sec</p>

<p>inet 192.168.3.<sup>118</sup>&frasl;<sub>32</sub> scope global eno!6777736 valid ä¸€1ft forever preferredä¸€1ft forever #å¤‡èŠ‚ç‚¹å¯åŠ¨keepalived</p>

<p>[root@node2 ã€œ/usr/local/keepalived/sbin/keepalived ~D -f /etc/keepalived/keepalived.conf</p>

<p>[root@node2 # ip addr list</p>

<p>inet 192.168.3.<sup>88</sup>&frasl;<sub>24</sub> brd 172.16.45.255 scope global dynamic eno!6777736</p>

<p>åˆ†åˆ«åœ¨ä¸»å¤‡èŠ‚ç‚¹ä¸Šå¯åŠ¨keepalivedï¼Œç„¶åé€šè¿‡ipå‘½ä»¤æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼Œåœ¨ä¸»èŠ‚ç‚¹ethOæ¥å£ ä¸Šç»‘å®šäº† 192.168.3.118è¿™ä¸ªVIP,è€Œå¤‡èŠ‚ç‚¹å¤„äºç›‘å¬çš„çŠ¶æ€ã€‚WebæœåŠ¡å¯ä»¥é€šè¿‡VIPç›´æ¥è®¿ é—®ï¼Œå¦‚ã€ç¤ºä¾‹9-17ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-17]</p>

<p>[root@nodel conf]# curl <a href="http://I92.168.3.118">http://I92.168.3.118</a> Hello 192.168.3.1</p>

<p>[root@nodel conf3 # curl http: &ldquo;192ï¼Œ168.3.118</p>

<p>2.æµ‹è¯• keepalived</p>

<p>æ•…éšœæ¨¡æ‹Ÿä¸»è¦åˆ†ä¸ºä¸»èŠ‚ç‚¹é‡å¯ï¼ŒæœåŠ¡æ¢å¤ï¼Œæ­¤æ—¶å¤‡èŠ‚ç‚¹æ­£å¸¸æœåŠ¡ï¼Œå½“ä¸»èŠ‚ç‚¹æ¢å¤åä¸»èŠ‚ç‚¹ é‡æ–°æ¥ç®¡èµ„æºæ­£å¸¸æœåŠ¡ã€‚æµ‹è¯•è¿‡ç¨‹å¦‚ã€ç¤ºä¾‹9-18ã€‘æ‰€ç¤ºã€‚</p>

<p>ã€ç¤ºä¾‹9-18ã€‘</p>

<p>#ä¸»èŠ‚ç‚¹æœåŠ¡ç»ˆæ­¢</p>

<p>[root@nodel keepalived]# reboot #å¤‡èŠ‚ç‚¹æ¥ç®¡æœåŠ¡</p>

<p>[root@nodel conf]# ip addr list #éƒ¨åˆ†ç»“æœçœç•¥</p>

<p>inet 192.168,3.<sup>118</sup>&frasl;<sub>32</sub> scope global eno!6777736 #æŸ»çœ‹å¤‡èŠ‚ç‚¹æ—¥å¿—</p>

<p>[root@node2 conf]# tail -f /var/log/messages</p>

<p>Jun 16 07:12:46 LD_192ä¸€168_3__88 keepalive&lt;^_vrrp [54537] : VRRPä¸€å·¥ nstance Transition to MASTER STATE</p>

<p>Jun 16 07:12:47 LD_192_168_3_88 keepalived_vrrp[54537]: VRRP_Instance(VI_1) Entering MASTER STATE</p>

<p>Jun 16 07:12:47 LD 192 168 3 88 keepalived vrrp[54537]: VRRP Instance(VI_1) â€”    â€”â€”    â€”â€”â€” *</p>

<p>setting protocol VIPs.</p>

<p>Jun 16 07:12:47 LD 192 168 3 88 keepalived vrrp[54537]: VRRP Instance(VIä¸€1) Sending gratuitous ARPs on ethO for 192.168.3.118</p>

<p>Jun 16 07:12:47 LD_192_168_3_88 keepalivedä¸€healthcheckers[54536]: Netlink reflector reports IP 192.168.3.118 added</p>

<p>Jun 16 07:12:52 LD_192_168_3_88 keepalived_vrrp[54537]: VRRPä¸€Instance(VI_1) Sending gratuitous ARPs on ethO for 192.168.3.118</p>

<p>#ä¸»èŠ‚ç‚¹æ¢å¤åæŸ»çœ‹æœåŠ¡æƒ…å†µ</p>

<p>[root@nodel keepalived]# ip addr list</p>

<p>inet 192.168.3.<sup>118</sup>&frasl;<sub>32</sub> scope global enol6777736 #æŸ»çœ‹ä¸»èŠ‚ç‚¹æ›°å¿—</p>

<p>[root@nodel log]# tail /var/log/messages</p>

<p>Jun 16 07:16:43 LD_192_168_3__87 keepalived_vrrp[260L2]: VRRPä¸€Instance(VI~1) Transition to MASTER STATE</p>

<p>Jun 16 07:16:44 LD_192_168_3_87 keepalived_vrrp[26012]: VRRPä¸€Instance(VIä¸€1) Entering MASTER STATE</p>

<p>Jun 16 07:16:44 LD_192_168_3_87 keepalived_vrrp[26012]: VRRPä¸€Instance setting protocol VIPs.</p>

<p>Jun 16 07:16:44 LD_192_168_3__87 keepalived_vrrp[26012]: VRRP_Instance(VI_1) Sending gratuitous ARPs on ethl for 192.168.3.118</p>

<p>Jun 16 07:16:49 LD__192_168_3_87 keepalived_vrrp[26012]: VRRP^Instance(VI_1) Sending gratuitous ARPs on ethl for 192.168.3.118</p>

<p>å½“ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå¤‡èŠ‚ç‚¹é¦–å…ˆå°†è‡ªå·±è®¾ç½®ä¸ºMASTERèŠ‚ç‚¹ï¼Œç„¶åæ¥ç®¡èµ„æºå¹¶å¯¹å¤–æä¾›æœ åŠ¡ï¼Œä¸»èŠ‚ç‚¹æ•…éšœæ¢å¤æ—¶ï¼Œå¤‡èŠ‚ç‚¹é‡æ–°è®¾ç½®ä¸ºBACKUPæ¨¡å¼ï¼Œä¸»èŠ‚ç‚¹ç»§ç»­æä¾›æœåŠ¡ã€‚keepalived æä¾›äº†å…¶ä»–ä¸°å¯Œçš„åŠŸèƒ½ï¼Œå¦‚æ•…éšœæ£€æµ‹ã€å¥åº·æ£€æŸ¥ã€æ•…éšœåçš„é¢„å¤„ç†ç­‰ï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥é˜…å¸®åŠ© æ–‡æ¡£ã€‚</p>

<p>â€¢å¾—å°ç»“</p>

<p>äº’è”ç½‘ä¸šåŠ¡çš„å‘å±•è¦æ±‚æœåŠ¡å™¨èƒ½å¤Ÿæä¾›ä¸é—´æ–­æœåŠ¡ï¼Œä¸ºé¿å…æœåŠ¡å™¨å®•æœºè€Œé€ æˆæŸå¤±ï¼Œéœ€è¦ å¯¹æœåŠ¡å™¨å®ç°å†—ä½™ã€‚åœ¨ä¼—å¤šå®ç°æœåŠ¡å™¨å†—ä½™çš„è§£å†³æ–¹æ¡ˆä¸­ï¼Œå¼€æºé«˜å¯ç”¨è½¯ä»¶Pacemakerå’Œ keepalivedæ˜¯ç›®å‰ä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„é«˜å¯ç”¨é›†ç¾¤è½¯ä»¶ã€‚æœ¬ç« åˆ†åˆ«ä»‹ç»äº† Pacemakerå’Œkeepalived çš„éƒ¨ç½²åŠåº”ç”¨ã€‚ä¸¤è€…çš„å…±åŒç‚¹æ˜¯éƒ½å¯ä»¥å®ç°èŠ‚ç‚¹çš„æ•…éšœæ¢æµ‹åŠæ•…éšœèŠ‚ç‚¹èµ„æºçš„æ¥ç®¡ï¼Œåœ¨ä½¿ç”¨æ–¹ é¢å¹¶æ²¡æœ‰å®è´¨æ€§çš„åŒºåˆ«ï¼Œè¯»è€…å¯æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œé€‰æ‹©ã€‚</p>

    </div>

    
    

    
    

    <footer class="post-footer">
      

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/03-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/01-%E5%9F%BA%E7%A1%80%E7%BC%96%E7%A8%8B/01-%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/02-python/%E7%BC%96%E5%86%99%E9%AB%98%E8%B4%A8%E9%87%8F%E4%BB%A3%E7%A0%81-%E6%94%B9%E5%96%84-python-%E7%A8%8B%E5%BA%8F%E7%9A%8491%E4%B8%AA%E5%BB%BA%E8%AE%AE/08-%E6%80%A7%E8%83%BD%E5%89%96%E6%9E%90%E4%B8%8E%E4%BC%98%E5%8C%96/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">08 æ€§èƒ½å‰–æä¸ä¼˜åŒ–</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/01-%E7%9F%A5%E8%AF%86%E6%A0%91/03-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/05-%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91/01-%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/02-linux-%E7%8E%AF%E5%A2%83/centos7-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%88%98/10-kvm%E8%99%9A%E6%8B%9F%E5%8C%96%E5%92%8C-ovirt%E8%99%9A%E6%8B%9F%E5%8C%96%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/">
            <span class="next-text nav-default">10 KVMè™šæ‹ŸåŒ–å’Œ oVirtè™šæ‹ŸåŒ–ç®¡ç†å¹³å°</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="iteratelyd@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="http://github.com/iterateself" class="iconfont icon-github" title="github"></a>
      <a href="https://www.zhihu.com/people/thebegin/activities" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.douban.com/people/68028070/" class="iconfont icon-douban" title="douban"></a>
  <a href="http://iterate.site/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
    <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">iterateself</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script type="text/javascript" src="/dist/even.min.js?v=3.2.0"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>








</body>
</html>
